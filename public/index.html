<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="ccrsky,javascript,前端开发" />





  <link rel="alternate" href="/atom.xml" title="ccrsky" type="application/atom+xml" />






<meta name="description" content="聚沙成塔，集腋成裘">
<meta property="og:type" content="website">
<meta property="og:title" content="ccrsky">
<meta property="og:url" content="https://ccrsky.github.io/index.html">
<meta property="og:site_name" content="ccrsky">
<meta property="og:description" content="聚沙成塔，集腋成裘">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ccrsky">
<meta name="twitter:description" content="聚沙成塔，集腋成裘">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ccrsky.github.io/"/>





  <title>ccrsky</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ccrsky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2018/02/26/mysql配置文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/26/mysql配置文件/" itemprop="url">mysql配置文件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-26T20:02:12+08:00">
                2018-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>mysql官网安装包中(5.7.18之后版本)不再提供my-default.cnf文件，可以从<a href="https://dev.mysql.com/doc/refman/5.7/en/option-files.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/option-files.html</a>找到配置项进行配置，看也可以按如下配置(参考<a href="http://www.fx114.net/qa-220-164752.aspx" target="_blank" rel="noopener">http://www.fx114.net/qa-220-164752.aspx</a>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">###############################基础设置#####################################</span><br><span class="line"></span><br><span class="line">#Mysql服务的唯一编号 每个mysql服务Id需唯一</span><br><span class="line">server-id = 1</span><br><span class="line"></span><br><span class="line">#服务端口号 默认3306</span><br><span class="line">port = 3306</span><br><span class="line"></span><br><span class="line">#mysql安装根目录</span><br><span class="line">basedir = /opt/mysql</span><br><span class="line"></span><br><span class="line">#mysql数据文件所在位置</span><br><span class="line">datadir = /opt/mysql/data</span><br><span class="line"></span><br><span class="line">#临时目录 比如load data infile会用到</span><br><span class="line">tmpdir  = /tmp</span><br><span class="line"></span><br><span class="line">#设置socke文件所在目录</span><br><span class="line">socket  = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">#主要用于MyISAM存储引擎,如果多台服务器连接一个数据库则建议注释下面内容</span><br><span class="line">skip-external-locking</span><br><span class="line"></span><br><span class="line">#只能用IP地址检查客户端的登录，不用主机名</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line"></span><br><span class="line">#事务隔离级别，默认为可重复读，mysql默认可重复读级别（此级别下可能参数很多间隙锁，影响性能）</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line"></span><br><span class="line">#数据库默认字符集,主流字符集支持一些特殊表情符号（特殊表情符占用4个字节）</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line"></span><br><span class="line">#数据库字符集对应一些排序等规则，注意要和character-set-server对应</span><br><span class="line">collation-server = utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line">#设置client连接mysql时的字符集,防止乱码</span><br><span class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</span><br><span class="line"></span><br><span class="line">#是否对sql语句大小写敏感，1表示不敏感</span><br><span class="line">lower_case_table_names = 1</span><br><span class="line"></span><br><span class="line">#最大连接数</span><br><span class="line">max_connections = 400</span><br><span class="line"></span><br><span class="line">#最大错误连接数</span><br><span class="line">max_connect_errors = 1000</span><br><span class="line"></span><br><span class="line">#TIMESTAMP如果没有显示声明NOT NULL，允许NULL值</span><br><span class="line">explicit_defaults_for_timestamp = true</span><br><span class="line"></span><br><span class="line">#SQL数据包发送的大小，如果有BLOB对象建议修改成1G</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line"></span><br><span class="line">#MySQL连接闲置超过一定时间后(单位：秒)将会被强行关闭</span><br><span class="line">#MySQL默认的wait_timeout  值为8个小时, interactive_timeout参数需要同时配置才能生效</span><br><span class="line">interactive_timeout = 1800</span><br><span class="line">wait_timeout = 1800</span><br><span class="line"></span><br><span class="line">#内部内存临时表的最大值 ，设置成128M。</span><br><span class="line">#比如大数据量的group by ,order by时可能用到临时表，</span><br><span class="line">#超过了这个值将写入磁盘，系统IO压力增大</span><br><span class="line">tmp_table_size = 134217728</span><br><span class="line">max_heap_table_size = 134217728</span><br><span class="line"></span><br><span class="line">#禁用mysql的缓存查询结果集功能</span><br><span class="line">#后期根据业务情况测试决定是否开启</span><br><span class="line">#大部分情况下关闭下面两项</span><br><span class="line">query_cache_size = 0</span><br><span class="line">query_cache_type = 0</span><br><span class="line"></span><br><span class="line">#####################用户进程分配到的内存设置BEGIN#############################</span><br><span class="line"></span><br><span class="line">##每个session将会分配参数设置的内存大小</span><br><span class="line">#用于表的顺序扫描，读出的数据暂存于read_buffer_size中，当buff满时或读完，将数据返回上层调用者</span><br><span class="line">#一般在128kb ~ 256kb,用于MyISAM</span><br><span class="line">#read_buffer_size = 131072</span><br><span class="line">#用于表的随机读取，当按照一个非索引字段排序读取时会用到，</span><br><span class="line">#一般在128kb ~ 256kb,用于MyISAM</span><br><span class="line">#read_rnd_buffer_size = 262144</span><br><span class="line">#order by或group by时用到</span><br><span class="line"></span><br><span class="line">#建议先调整为2M，后期观察调整</span><br><span class="line">sort_buffer_size = 2097152</span><br><span class="line"></span><br><span class="line">#一般数据库中没什么大的事务，设成1~2M，默认32kb</span><br><span class="line">binlog_cache_size = 524288</span><br><span class="line"></span><br><span class="line">########################用户进程分配到的内存设置END############################</span><br><span class="line"></span><br><span class="line">#在MySQL暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中</span><br><span class="line">#官方建议back_log = 50 + (max_connections / 5),封顶数为900</span><br><span class="line">back_log = 130</span><br><span class="line"></span><br><span class="line">############################日志设置##########################################</span><br><span class="line"></span><br><span class="line">#数据库错误日志文件</span><br><span class="line">log_error = error.log</span><br><span class="line"></span><br><span class="line">#慢查询sql日志设置</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = slow.log</span><br><span class="line"></span><br><span class="line">#检查未使用到索引的sql</span><br><span class="line">log_queries_not_using_indexes = 1</span><br><span class="line"></span><br><span class="line">#针对log_queries_not_using_indexes开启后，记录慢sql的频次、每分钟记录的条数</span><br><span class="line">log_throttle_queries_not_using_indexes = 5</span><br><span class="line"></span><br><span class="line">#作为从库时生效,从库复制中如何有慢sql也将被记录</span><br><span class="line">log_slow_slave_statements = 1</span><br><span class="line"></span><br><span class="line">#慢查询执行的秒数，必须达到此值可被记录</span><br><span class="line">long_query_time = 8</span><br><span class="line"></span><br><span class="line">#检索的行数必须达到此值才可被记为慢查询</span><br><span class="line">min_examined_row_limit = 100</span><br><span class="line"></span><br><span class="line">#mysql binlog日志文件保存的过期时间，过期后自动删除</span><br><span class="line">expire_logs_days = 5</span><br><span class="line"></span><br><span class="line">############################主从复制设置#####################################</span><br><span class="line"></span><br><span class="line">#开启mysql binlog功能</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">#binlog记录内容的方式，记录被操作的每一行</span><br><span class="line">binlog_format = ROW</span><br><span class="line"></span><br><span class="line">#对于binlog_format = ROW模式时，减少记录日志的内容，只记录受影响的列</span><br><span class="line">binlog_row_image = minimal</span><br><span class="line"></span><br><span class="line">#master status and connection information输出到表mysql.slave_master_info中</span><br><span class="line">master_info_repository = TABLE</span><br><span class="line"></span><br><span class="line">#the slave&apos;s position in the relay logs输出到表mysql.slave_relay_log_info中</span><br><span class="line">relay_log_info_repository = TABLE</span><br><span class="line"></span><br><span class="line">#作为从库时生效,想进行级联复制，则需要此参数</span><br><span class="line">log_slave_updates</span><br><span class="line"></span><br><span class="line">#作为从库时生效,中继日志relay-log可以自我修复</span><br><span class="line">relay_log_recovery = 1</span><br><span class="line"></span><br><span class="line">#作为从库时生效,主从复制时忽略的错误</span><br><span class="line">slave_skip_errors = ddl_exist_errors</span><br><span class="line"></span><br><span class="line">#####################redo log和binlog的关系设置BEGIN#########################</span><br><span class="line"></span><br><span class="line">#(步骤1) prepare dml相关的SQL操作，然后将redo log buff中的缓存持久化到磁盘</span><br><span class="line">#(步骤2)如果前面prepare成功，那么再继续将事务日志持久化到binlog</span><br><span class="line">#(步骤3)如果前面成功，那么在redo log里面写上一个commit记录</span><br><span class="line">#当innodb_flush_log_at_trx_commit和sync_binlog都为1时是最安全的，</span><br><span class="line">#在mysqld服务崩溃或者服务器主机crash的情况下，binary log只有可能丢失最多一个语句或者一个事务。</span><br><span class="line">#但是都设置为1时会导致频繁的io操作，因此该模式也是最慢的一种方式。</span><br><span class="line">#当innodb_flush_log_at_trx_commit设置为0，mysqld进程的崩溃会导致上一秒钟所有事务数据的丢失。</span><br><span class="line">#当innodb_flush_log_at_trx_commit设置为2，只有在操作系统崩溃或者系统掉电的情况下，上一秒钟所有事务数据才可能丢失。</span><br><span class="line"></span><br><span class="line">#commit事务时,控制redo log buff持久化磁盘的模式 默认为1</span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line"></span><br><span class="line">#commit事务时,控制写入mysql binlog日志的模式 默认为0</span><br><span class="line">#innodb_flush_log_at_trx_commit和sync_binlog都为1时，mysql最为安全但性能上压力也是最大</span><br><span class="line">sync_binlog = 1</span><br><span class="line"></span><br><span class="line">####################redo log和binlog的关系设置END############################</span><br><span class="line"></span><br><span class="line">############################Innodb设置#####################################</span><br><span class="line"></span><br><span class="line">#数据块的单位8k，默认是16k，16kCPU压力稍小，8k对select的吞吐量大</span><br><span class="line">#innodb_page_size的参数值也影响最大索引长度，8k比16k的最大索引长度小</span><br><span class="line">#innodb_page_size = 8192</span><br><span class="line"></span><br><span class="line">#一般设置物理存储的60% ~ 70%</span><br><span class="line">innodb_buffer_pool_size = 1G</span><br><span class="line"></span><br><span class="line">#5.7.6之后默认16M</span><br><span class="line">#innodb_log_buffer_size = 16777216</span><br><span class="line"></span><br><span class="line">#该参数针对unix、linux，window上直接注释该参数.默认值为NULL</span><br><span class="line">#O_DIRECT减少操作系统级别VFS的缓存和Innodb本身的buffer缓存之间的冲突</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line"></span><br><span class="line">#此格式支持压缩, 5.7.7之后为默认值</span><br><span class="line">innodb_file_format = Barracuda</span><br><span class="line"></span><br><span class="line">#CPU多核处理能力设置，假设CPU是2颗4核的，设置如下</span><br><span class="line">#读多，写少可以设成2:6的比例</span><br><span class="line">innodb_write_io_threads = 4</span><br><span class="line">innodb_read_io_threads = 4</span><br><span class="line"></span><br><span class="line">#提高刷新脏页数量和合并插入数量，改善磁盘I/O处理能力</span><br><span class="line">#默认值200（单位：页）</span><br><span class="line">#可根据磁盘近期的IOPS确定该值</span><br><span class="line">innodb_io_capacity = 500</span><br><span class="line"></span><br><span class="line">#为了获取被锁定的资源最大等待时间，默认50秒，超过该时间会报如下错误:</span><br><span class="line"># ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">innodb_lock_wait_timeout = 30</span><br><span class="line"></span><br><span class="line">#调整buffer pool中最近使用的页读取并dump的百分比,通过设置该参数可以减少转储的page数</span><br><span class="line">innodb_buffer_pool_dump_pct = 40</span><br><span class="line"></span><br><span class="line">#设置redoLog文件所在目录, redoLog记录事务具体操作内容</span><br><span class="line">innodb_log_group_home_dir = /opt/mysql/redolog/</span><br><span class="line"></span><br><span class="line">#设置undoLog文件所在目录, undoLog用于事务回滚操作</span><br><span class="line">innodb_undo_directory = /opt/mysql/undolog/</span><br><span class="line"></span><br><span class="line">#在innodb_log_group_home_dir中的redoLog文件数, redoLog文件内容是循环覆盖写入。</span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line"></span><br><span class="line">#MySql5.7官方建议尽量设置的大些，可以接近innodb_buffer_pool_size的大小</span><br><span class="line">#之前设置该值较大时可能导致mysql宕机恢复时间过长，现在恢复已经加快很多了</span><br><span class="line">#该值减少脏数据刷新到磁盘的频次</span><br><span class="line">#最大值innodb_log_file_size * innodb_log_files_in_group &lt;= 512GB,单文件&lt;=256GB</span><br><span class="line">innodb_log_file_size = 1024M</span><br><span class="line"></span><br><span class="line">#设置undoLog文件所占空间可以回收</span><br><span class="line">#5.7之前的MySql的undoLog文件一直增大无法回收</span><br><span class="line">innodb_undo_log_truncate = 1</span><br><span class="line">innodb_undo_tablespaces = 3</span><br><span class="line">innodb_undo_logs = 128</span><br><span class="line"></span><br><span class="line">#5.7.7默认开启该参数 控制单列索引长度最大达到3072</span><br><span class="line">#innodb_large_prefix = 1</span><br><span class="line"></span><br><span class="line">#5.7.8默认为4个, Inodb后台清理工作的线程数</span><br><span class="line">#innodb_purge_threads = 4</span><br><span class="line"></span><br><span class="line">#通过设置配置参数innodb_thread_concurrency来限制并发线程的数量，</span><br><span class="line">#一旦执行线程的数量达到这个限制，额外的线程在被放置到对队列中之前，会睡眠数微秒，</span><br><span class="line">#可以通过设定参数innodb_thread_sleep_delay来配置睡眠时间</span><br><span class="line">#该值默认为0,在官方doc上，对于innodb_thread_concurrency的使用，也给出了一些建议:</span><br><span class="line">#(1)如果一个工作负载中，并发用户线程的数量小于64，建议设置innodb_thread_concurrency=0；</span><br><span class="line">#(2)如果工作负载一直较为严重甚至偶尔达到顶峰，建议先设置innodb_thread_concurrency=128,</span><br><span class="line">###并通过不断的降低这个参数，96, 80, 64等等，直到发现能够提供最佳性能的线程数</span><br><span class="line">#innodb_thread_concurrency = 0</span><br><span class="line"></span><br><span class="line">#强所有发生的死锁错误信息记录到error.log中，之前通过命令行只能查看最近一次死锁信息</span><br><span class="line">innodb_print_all_deadlocks = 1</span><br><span class="line"></span><br><span class="line">############################其他设置########################################</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 128M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 20M</span><br><span class="line">sort_buffer_size = 256k</span><br><span class="line">read_buffer = 2M</span><br><span class="line">write_buffer = 2M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">#增加每个进程的可打开文件数量</span><br><span class="line">open-files-limit = 28192</span><br></pre></td></tr></table></figure>
<p>大家可根据需求进行相应配置。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2018/01/31/pm2的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/31/pm2的使用/" itemprop="url">pm2的使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-31T20:52:26+08:00">
                2018-01-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>pm2是一个高级node进程管理工具，通过它不仅可以管理node应用，也可以管理Python等其他语言的应用；本文是看完官网后做的笔录，适合快速入门pm2命令行工具的使用，具体细节可参考<a href="http://pm2.keymetrics.io/docs/usage/quick-start/" target="_blank" rel="noopener">官网介绍</a></p>
<h3 id="pm2使用"><a href="#pm2使用" class="headerlink" title="pm2使用"></a>pm2使用</h3><h4 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h4><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2@latest -g</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure>
<p>通过配置文件管理多个应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 创建 process.yml内容如下：</span><br><span class="line">apps:</span><br><span class="line">  - script   : app.js</span><br><span class="line">    instances: 4</span><br><span class="line">    exec_mode: cluster</span><br><span class="line">  - script : worker.js</span><br><span class="line">    watch  : true</span><br><span class="line">    env    :</span><br><span class="line">      NODE_ENV: development</span><br><span class="line">    env_production:</span><br><span class="line">      NODE_ENV: production</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"># 运行应用</span><br><span class="line">pm2 start process.yml</span><br><span class="line"></span><br><span class="line"># 随系统启动</span><br><span class="line">pm2 startup</span><br></pre></td></tr></table></figure>
<p>与<code>pm2</code>相关的所有配置位于<code>$HOME/.pm2</code>下</p>
<ul>
<li>logs 应用log</li>
<li>pids 应用pid</li>
<li>sock 套接字文件</li>
<li>conf.js 配置文件</li>
</ul>
<p>更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 全局安装</span><br><span class="line">npm install pm2@latest -g</span><br><span class="line"></span><br><span class="line"># 内存更新</span><br><span class="line">pm2 update</span><br></pre></td></tr></table></figure>
<p>命令清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"># Fork mode</span><br><span class="line">pm2 start app.js --name my-api # Name process</span><br><span class="line"></span><br><span class="line"># Cluster mode</span><br><span class="line">pm2 start app.js -i 0        # Will start maximum processes with LB depending on available CPUs</span><br><span class="line">pm2 start app.js -i max      # Same as above, but deprecated.</span><br><span class="line"></span><br><span class="line"># Listing</span><br><span class="line"></span><br><span class="line">pm2 list</span><br><span class="line"># Or</span><br><span class="line">pm2 [list|ls|l|status]</span><br><span class="line"></span><br><span class="line"># 显示进程详情</span><br><span class="line">pm2 show 0</span><br><span class="line"></span><br><span class="line">pm2 list               # Display all processes status</span><br><span class="line">pm2 jlist              # Print process list in raw JSON</span><br><span class="line">pm2 prettylist         # Print process list in beautified JSON</span><br><span class="line"></span><br><span class="line">pm2 describe 0         # Display all informations about a specific process</span><br><span class="line"></span><br><span class="line">pm2 monit              # Monitor all processes</span><br><span class="line"></span><br><span class="line"># Logs</span><br><span class="line"></span><br><span class="line">pm2 logs [--raw]       # Display all processes logs in streaming</span><br><span class="line">pm2 flush              # Empty all log files</span><br><span class="line">pm2 reloadLogs         # Reload all logs</span><br><span class="line"></span><br><span class="line"># Actions</span><br><span class="line"></span><br><span class="line">pm2 stop all           # Stop all processes</span><br><span class="line">pm2 restart all        # Restart all processes</span><br><span class="line"></span><br><span class="line">pm2 reload all         # Will 0s downtime reload (for NETWORKED apps)</span><br><span class="line"></span><br><span class="line">pm2 stop 0             # Stop specific process id</span><br><span class="line">pm2 restart 0          # Restart specific process id</span><br><span class="line"></span><br><span class="line"># 重启服务</span><br><span class="line">pm2 restart myapp          # Restart specific process id</span><br><span class="line"></span><br><span class="line"># 根据应用名称删除</span><br><span class="line">pm2 delete myapp          </span><br><span class="line">pm2 delete 0           # Will remove process from pm2 list</span><br><span class="line">pm2 delete all         # Will remove all processes from pm2 list</span><br><span class="line"></span><br><span class="line"># Misc</span><br><span class="line"></span><br><span class="line">pm2 reset &lt;process&gt;    # Reset meta data (restarted time...)</span><br><span class="line">pm2 updatePM2          # Update in memory pm2</span><br><span class="line">pm2 ping               # Ensure pm2 daemon has been launched</span><br><span class="line">pm2 sendSignal SIGUSR2 my-app # Send system signal to script</span><br><span class="line">pm2 start app.js --no-daemon</span><br><span class="line">pm2 start app.js --no-vizion</span><br><span class="line">pm2 start app.js --no-autorestart</span><br><span class="line"></span><br><span class="line"># 给应用传递参数</span><br><span class="line">pm2 start app.js -- -a 23  # Pass arguments &apos;-a 23&apos; argument to app.js script</span><br><span class="line">pm2 start app.js --node-args=&quot;--debug=7001&quot; # --node-args to pass options to node V8</span><br><span class="line"></span><br><span class="line">pm2 start app.js --log-date-format &quot;YYYY-MM-DD HH:mm Z&quot;    # Log will be prefixed with custom time format</span><br><span class="line"></span><br><span class="line"># 以json文件方式启动</span><br><span class="line">pm2 start app.json                # Start processes with options declared in app.json</span><br><span class="line"></span><br><span class="line"># 指定多应用中的具体应用</span><br><span class="line">pm2 reload process.json --only api  </span><br><span class="line">       </span><br><span class="line"># 自定义日志文件                                    </span><br><span class="line">pm2 start app.js -e err.log -o out.log  # Start and specify error and out log</span><br><span class="line"></span><br><span class="line"># PM2 2.4.0后 可以通过正则批量操作</span><br><span class="line">pm2 restart/delete/stop/reload  /http-[1,2]/</span><br></pre></td></tr></table></figure>
<p>启动其他语言应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 启动其他语言的进程</span><br><span class="line">pm2 start echo.php</span><br><span class="line">pm2 start echo.py</span><br><span class="line">pm2 start echo.sh</span><br><span class="line"></span><br><span class="line"># 映射关系 - 解释器</span><br><span class="line">&#123;</span><br><span class="line">  &quot;.sh&quot;: &quot;bash&quot;,</span><br><span class="line">  &quot;.py&quot;: &quot;python&quot;,</span><br><span class="line">  &quot;.rb&quot;: &quot;ruby&quot;,</span><br><span class="line">  &quot;.coffee&quot; : &quot;coffee&quot;,</span><br><span class="line">  &quot;.php&quot;: &quot;php&quot;,</span><br><span class="line">  &quot;.pl&quot; : &quot;perl&quot;,</span><br><span class="line">  &quot;.js&quot; : &quot;node&quot;</span><br><span class="line">&#125;</span><br><span class="line"># 通过配置文件的方式启动，非js应用必须指定exec_mode: &apos;fork_mode&apos; and exec_interpreter至对应的解释器</span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;name&quot;       : &quot;bash-worker&quot;,</span><br><span class="line">    &quot;script&quot;     : &quot;./a-bash-script&quot;,</span><br><span class="line">    &quot;exec_interpreter&quot;: &quot;bash&quot;,   </span><br><span class="line">    &quot;exec_mode&quot;  : &quot;fork_mode&quot;</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    &quot;name&quot;       : &quot;ruby-worker&quot;,</span><br><span class="line">    &quot;script&quot;     : &quot;./some-ruby-script&quot;,</span><br><span class="line">    &quot;exec_interpreter&quot;: &quot;ruby&quot;,</span><br><span class="line">    &quot;exec_mode&quot;  : &quot;fork_mode&quot;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>控制应用内存大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 启动应用 显示内存大小</span><br><span class="line">pm2 start big-array.js --max-memory-restart 20M</span><br><span class="line"></span><br><span class="line"># JSON</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;   : &quot;max_mem&quot;,</span><br><span class="line">  &quot;script&quot; : &quot;big-array.js&quot;,</span><br><span class="line">  &quot;max_memory_restart&quot; : &quot;20M&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 使用脚本方式控制内存大小</span><br><span class="line">pm2.start(&#123;</span><br><span class="line">  name               : &quot;max_mem&quot;,</span><br><span class="line">  script             : &quot;big-array.js&quot;,</span><br><span class="line">  max_memory_restart : &quot;20M&quot;</span><br><span class="line">&#125;, function(err, proc) &#123;</span><br><span class="line">  // Processing</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"># 单位  K(ilobyte), M(egabyte), G(igabyte)</span><br><span class="line">50M</span><br><span class="line">50K</span><br><span class="line">1G</span><br></pre></td></tr></table></figure>
<h3 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h3><p>根据cpus个数生成多个应用实例，提高应用的性能及可靠性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js -i max</span><br><span class="line"># max:pm2自动检测cpus个数</span><br><span class="line"></span><br><span class="line"># 通过配置 js/yaml/json file</span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;script&quot;    : &quot;api.js&quot;,</span><br><span class="line">    &quot;instances&quot; : &quot;max&quot;,</span><br><span class="line">    &quot;exec_mode&quot; : &quot;cluster&quot;   </span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line">pm2默认不会负载均衡，需要制定 exec_mode为 cluster</span><br><span class="line"></span><br><span class="line">-i 参数项</span><br><span class="line">0/max: = CPUs</span><br><span class="line">-1 : CPUs - 1</span><br><span class="line">number: &lt;= CPUS</span><br></pre></td></tr></table></figure>
<p>应用平滑关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.on(&apos;SIGINT&apos;, function() &#123;</span><br><span class="line">   db.stop(function(err) &#123;</span><br><span class="line">     process.exit(err ? 1 : 0);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="启动配置文件"><a href="#启动配置文件" class="headerlink" title="启动配置文件"></a>启动配置文件</h3><h4 id="配置文件格式"><a href="#配置文件格式" class="headerlink" title="配置文件格式"></a>配置文件格式</h4><ul>
<li>javascript</li>
<li>json</li>
<li>yaml</li>
</ul>
<p>生成配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 生成 ecosystem.config.js</span><br><span class="line">pm2 ecosystem</span><br><span class="line"></span><br><span class="line"># 生成文件不带注释</span><br><span class="line">pm2 ecosystem simple</span><br></pre></td></tr></table></figure>
<p>JavaScript格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  apps : [&#123;</span><br><span class="line">    name        : &quot;worker&quot;,</span><br><span class="line">    script      : &quot;./worker.js&quot;,</span><br><span class="line">    watch       : true,</span><br><span class="line">    env: &#123;</span><br><span class="line">      &quot;NODE_ENV&quot;: &quot;development&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">    env_production : &#123;</span><br><span class="line">       &quot;NODE_ENV&quot;: &quot;production&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    name       : &quot;api-app&quot;,</span><br><span class="line">    script     : &quot;./api.js&quot;,</span><br><span class="line">    instances  : 4,</span><br><span class="line">    exec_mode  : &quot;cluster&quot;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>json格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;name&quot;        : &quot;worker&quot;,</span><br><span class="line">    &quot;script&quot;      : &quot;./worker.js&quot;,</span><br><span class="line">    &quot;watch&quot;       : true,</span><br><span class="line">    &quot;env&quot;: &#123;</span><br><span class="line">      &quot;NODE_ENV&quot;: &quot;development&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;env_production&quot; : &#123;</span><br><span class="line">       &quot;NODE_ENV&quot;: &quot;production&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    &quot;name&quot;       : &quot;api-app&quot;,</span><br><span class="line">    &quot;script&quot;     : &quot;./api.js&quot;,</span><br><span class="line">    &quot;instances&quot;  : 4,</span><br><span class="line">    &quot;exec_mode&quot;  : &quot;cluster&quot;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yaml格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apps:</span><br><span class="line">  - script   : ./api.js</span><br><span class="line">    name     : &apos;api-app&apos;</span><br><span class="line">    instances: 4</span><br><span class="line">    exec_mode: cluster</span><br><span class="line">  - script : ./worker.js</span><br><span class="line">    name   : &apos;worker&apos;</span><br><span class="line">    watch  : true</span><br><span class="line">    env    :</span><br><span class="line">      NODE_ENV: development</span><br><span class="line">    env_production:</span><br><span class="line">      NODE_ENV: production</span><br></pre></td></tr></table></figure>
<p>根据配置文件管理应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pm2 start ecosystem.config.js</span><br><span class="line"></span><br><span class="line"># 启动配置文件中具体某个应用</span><br><span class="line">pm2 start ecosystem.config.js --only worker-app</span><br><span class="line"></span><br><span class="line"># 停止配置文件中指定的所有应用</span><br><span class="line">pm2 stop ecosystem.config.js</span><br><span class="line"></span><br><span class="line"># 重启所有应用</span><br><span class="line">pm2 start   ecosystem.config.js</span><br><span class="line">## Or</span><br><span class="line">pm2 restart ecosystem.config.js</span><br><span class="line"></span><br><span class="line"># 重新加载所有应用</span><br><span class="line">pm2 reload ecosystem.config.js</span><br><span class="line"></span><br><span class="line"># 删除所有应用</span><br><span class="line">pm2 delete ecosystem.config.js</span><br></pre></td></tr></table></figure>
<p>更新环境变量信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pm2 restart ecosystem.config.js --update-env</span><br><span class="line">pm2 startOrReload ecosystem.config.js --update-env</span><br><span class="line"></span><br><span class="line"># 根据参数自动注入环境变量  env_&lt;name&gt;</span><br><span class="line">pm2 start process.json --env production</span><br></pre></td></tr></table></figure>
<h4 id="配置参数列表"><a href="#配置参数列表" class="headerlink" title="配置参数列表"></a>配置参数列表</h4>
<table>
  <thead>
    <tr>
      <th style="text-align: left">Field</th>
      <th style="text-align: center">Type</th>
      <th style="text-align: center">Example</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">name</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">“my-api”</td>
      <td style="text-align: left">application name (default to script filename without extension)</td>
    </tr>
    <tr>
      <td style="text-align: left">script</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">”./api/app.js”</td>
      <td style="text-align: left">script path relative to pm2 start</td>
    </tr>
    <tr>
      <td style="text-align: left">cwd</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">“/var/www/”</td>
      <td style="text-align: left">the directory from which your app will be launched</td>
    </tr>
    <tr>
      <td style="text-align: left">args</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">“-a 13 -b 12”</td>
      <td style="text-align: left">string containing all arguments passed via CLI to script</td>
    </tr>
    <tr>
      <td style="text-align: left">interpreter</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">“/usr/bin/python”</td>
      <td style="text-align: left">interpreter absolute path (default to node)</td>
    </tr>
    <tr>
      <td style="text-align: left">interpreter_args</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">”–harmony”</td>
      <td style="text-align: left">option to pass to the interpreter</td>
    </tr>
    <tr>
      <td style="text-align: left">node_args</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">&nbsp;</td>
      <td style="text-align: left">alias to interpreter_args</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td style="text-align: left">instances</td>
      <td style="text-align: center">number</td>
      <td style="text-align: center">-1</td>
      <td style="text-align: left">number of app instance to be launched</td>
    </tr>
    <tr>
      <td style="text-align: left">exec_mode</td>
      <td style="text-align: center">string</td>
      <td style="text-align: center">“cluster”</td>
      <td style="text-align: left">mode to start your app, can be “cluster” or “fork”, default fork</td>
    </tr>
    <tr>
      <td style="text-align: left">watch</td>
      <td style="text-align: center">boolean or []</td>
      <td style="text-align: center">true</td>
      <td style="text-align: left">enable watch &amp; restart feature, if a file change in the folder or subfolder, your app will get reloaded</td>
    </tr>
    <tr>
      <td style="text-align: left">ignore_watch</td>
      <td style="text-align: center">list</td>
      <td style="text-align: center">[”[\/\\]\./”, “node_modules”]</td>
      <td style="text-align: left">list of regex to ignore some file or folder names by the watch feature</td>
    </tr>
    <tr>
      <td style="text-align: left">max_memory_restart</td>
      <td style="text-align: center">string</td>
      <td style="text-align: center">“150M”</td>
      <td style="text-align: left">your app will be restarted if it exceeds the amount of memory specified. human-friendly format : it can be “10M”, “100K”, “2G” and so on…</td>
    </tr>
    <tr>
      <td style="text-align: left">env</td>
      <td style="text-align: center">object</td>
      <td style="text-align: center">{“NODE_ENV”: “development”, “ID”: “42”}</td>
      <td style="text-align: left">env variables which will appear in your app</td>
    </tr>
    <tr>
      <td style="text-align: left">env_<env_name></env_name></td>
      <td style="text-align: center">object</td>
      <td style="text-align: center">{“NODE_ENV”: “production”, “ID”: “89”}</td>
      <td style="text-align: left">inject <env_name> when doing pm2 restart app.yml --env <env_name></env_name></env_name></td>
    </tr>
    <tr>
      <td style="text-align: left">source_map_support</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">true</td>
      <td style="text-align: left">default to true, [enable/disable source map file]</td>
    </tr>
    <tr>
      <td style="text-align: left">instance_var</td>
      <td style="text-align: center">string</td>
      <td style="text-align: center">“NODE_APP_INSTANCE”</td>
      <td style="text-align: left"><a href="http://pm2.keymetrics.io/docs/usage/environment/#specific-environment-variables" target="_blank" rel="noopener">see documentation</a></td>
    </tr>
  </tbody>
  
  <tbody>
    <tr>
      <td style="text-align: left">log_date_format</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">“YYYY-MM-DD HH:mm Z”</td>
      <td style="text-align: left">log date format (see log section)</td>
    </tr>
    <tr>
      <td style="text-align: left">error_file</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">&nbsp;</td>
      <td style="text-align: left">error file path </td>
    </tr>
    <tr>
      <td style="text-align: left">out_file</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">&nbsp;</td>
      <td style="text-align: left">output file path </td>
    </tr>
    <tr>
      <td style="text-align: left">combine_logs</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">true</td>
      <td style="text-align: left">if set to true, avoid to suffix logs file with the process id</td>
    </tr>
    <tr>
      <td style="text-align: left">merge_logs</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">true</td>
      <td style="text-align: left">alias to combine_logs</td>
    </tr>
    <tr>
      <td style="text-align: left">pid_file</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">&nbsp;</td>
      <td style="text-align: left">pid file path (default to $HOME/.pm2/pid/app-pm_id.pid)</td>
    </tr>
  </tbody>
  
  <tbody>
    <tr>
      <td style="text-align: left">min_uptime</td>
      <td style="text-align: center">(string)</td>
      <td style="text-align: center">&nbsp;</td>
      <td style="text-align: left">min uptime of the app to be considered started</td>
    </tr>
    <tr>
      <td style="text-align: left">listen_timeout</td>
      <td style="text-align: center">number</td>
      <td style="text-align: center">8000</td>
      <td style="text-align: left">time in ms before forcing a reload if app not listening</td>
    </tr>
    <tr>
      <td style="text-align: left">kill_timeout</td>
      <td style="text-align: center">number</td>
      <td style="text-align: center">1600</td>
      <td style="text-align: left">time in milliseconds before sending <a href="http://pm2.keymetrics.io/docs/usage/signals-clean-restart/#cleaning-states-and-jobs" target="_blank" rel="noopener">a final SIGKILL</a></td>
    </tr>
    <tr>
      <td style="text-align: left">wait_ready</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">false</td>
      <td style="text-align: left">Instead of reload waiting for listen event, wait for process.send(‘ready’)</td>
    </tr>
    <tr>
      <td style="text-align: left">max_restarts</td>
      <td style="text-align: center">number</td>
      <td style="text-align: center">10</td>
      <td style="text-align: left">number of consecutive unstable restarts (less than 1sec interval or custom time via min_uptime) before your app is considered errored and stop being restarted</td>
    </tr>
    <tr>
      <td style="text-align: left">restart_delay</td>
      <td style="text-align: center">number</td>
      <td style="text-align: center">4000</td>
      <td style="text-align: left">time to wait before restarting a crashed app (in milliseconds). defaults to 0.</td>
    </tr>
    <tr>
      <td style="text-align: left">autorestart</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">false</td>
      <td style="text-align: left">true by default. if false, PM2 will not restart your app if it crashes or ends peacefully</td>
    </tr>
    <tr>
      <td style="text-align: left">cron_restart</td>
      <td style="text-align: center">string</td>
      <td style="text-align: center">“1 0 * * *”</td>
      <td style="text-align: left">a cron pattern to restart your app. Application must be running for cron feature to work</td>
    </tr>
    <tr>
      <td style="text-align: left">vizion</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">false</td>
      <td style="text-align: left">true by default. if false, PM2 will start without vizion features (versioning control metadatas)</td>
    </tr>
    <tr>
      <td style="text-align: left">post_update</td>
      <td style="text-align: center">list</td>
      <td style="text-align: center">[“npm install”, “echo launching the app”]</td>
      <td style="text-align: left">a list of commands which will be executed after you perform a Pull/Upgrade operation from Keymetrics dashboard</td>
    </tr>
    <tr>
      <td style="text-align: left">force</td>
      <td style="text-align: center">boolean</td>
      <td style="text-align: center">true</td>
      <td style="text-align: left">defaults to false. if true, you can start the same script several times which is usually not allowed by PM2</td>
    </tr>
  </tbody>
  
</table>

<blockquote>
<p>使用json配置文件的方式，命令行可选参数会无效,</p>
</blockquote>
<p>日志文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 不保存日志 </span><br><span class="line">设置 /dev/null to error_file or out_file  不保存日志文件.</span><br><span class="line"></span><br><span class="line"># 同一应用 日志内容放一起</span><br><span class="line">使用 merge_logs: true 禁止日志文件自动加上进程id后缀 (e.g. app-name-ID.log)</span><br></pre></td></tr></table></figure>
<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><h4 id="平滑停止"><a href="#平滑停止" class="headerlink" title="平滑停止"></a>平滑停止</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Graceful restart/reload/stop</span><br><span class="line">process.on(&apos;SIGINT&apos;, function() &#123;</span><br><span class="line">   db.stop(function(err) &#123;</span><br><span class="line">     process.exit(err ? 1 : 0);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"># 延时 3000ms</span><br><span class="line">pm2 start app.js --kill-timeout 3000</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;name&quot;         : &quot;api&quot;,</span><br><span class="line">    &quot;script&quot;       : &quot;app.js&quot;,</span><br><span class="line">    &quot;kill_timeout&quot; : 3000</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="平滑启动"><a href="#平滑启动" class="headerlink" title="平滑启动"></a>平滑启动</h4><p>某些应用运行需要等待DB或者workers建立好链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 应用发出ready正式更新状态</span><br><span class="line">pm2 start app.js --wait-ready</span><br><span class="line"></span><br><span class="line"># 应用链接处理完毕发送ready消息</span><br><span class="line">var http = require(&apos;http&apos;);</span><br><span class="line">var app = http.createServer(function(req, res) &#123;</span><br><span class="line">  res.writeHead(200);</span><br><span class="line">  res.end(&apos;hey&apos;);</span><br><span class="line">&#125;)</span><br><span class="line">var listener = app.listen(0, function() &#123;</span><br><span class="line">  console.log(&apos;Listening on port &apos; + listener.address().port);</span><br><span class="line">  // Here we send the ready signal to PM2</span><br><span class="line">  process.send(&apos;ready&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"># 默认超时时间为 3000ms</span><br><span class="line">pm2 start app.js --wait-ready --listen-timeout 3000</span><br><span class="line"></span><br><span class="line"># json方式指定</span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;name&quot;         : &quot;api&quot;,</span><br><span class="line">    &quot;script&quot;       : &quot;app.js&quot;,</span><br><span class="line">    &quot;listen_timeout&quot; : 3000</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 1.PM2 默认注入当前shell的环境变量</span><br><span class="line"># 2.PM2注入配置文件中声明的环境变量，重名则覆盖</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  apps : [</span><br><span class="line">      &#123;</span><br><span class="line">        name: &quot;myapp&quot;,</span><br><span class="line">        script: &quot;./app.js&quot;,</span><br><span class="line">        watch: true,</span><br><span class="line">        env: &#123;</span><br><span class="line">            &quot;PORT&quot;: 3000,</span><br><span class="line">            &quot;NODE_ENV&quot;: &quot;development&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        env_production: &#123;</span><br><span class="line">            &quot;PORT&quot;: 80,</span><br><span class="line">            &quot;NODE_ENV&quot;: &quot;production&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 根据运行环境，选择不同的环境变量</span><br><span class="line">ecosystem.config.js --env production</span><br><span class="line"></span><br><span class="line"># 默认  restarting or reloading 不会更新环境变量，如果需要更新可以使用如下方式</span><br><span class="line">pm2 reload ecosystem.json --update-env</span><br><span class="line"></span><br><span class="line"># 指定实例个数的环境变量</span><br><span class="line">NODE_APP_INSTANCE </span><br><span class="line"></span><br><span class="line"># 修改环境变量的名称</span><br><span class="line">instance_var: &apos;INSTANCE_ID&apos;,</span><br></pre></td></tr></table></figure>
<h3 id="应用日志管理"><a href="#应用日志管理" class="headerlink" title="应用日志管理"></a>应用日志管理</h3><p>PM2日志可以合并，也可以存放不同的日志文件中。</p>
<h4 id="实时显示日志"><a href="#实时显示日志" class="headerlink" title="实时显示日志"></a>实时显示日志</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 查看logs命令帮助</span><br><span class="line">pm2 logs -h</span><br><span class="line"></span><br><span class="line"># 显示所有应用日志</span><br><span class="line">pm2 logs</span><br><span class="line"></span><br><span class="line"># 指定正则匹配的应用的日志</span><br><span class="line">pm2 logs /api/</span><br><span class="line"></span><br><span class="line">pm2 logs /server_[12]/</span><br><span class="line"></span><br><span class="line"># 显示应用api的日志</span><br><span class="line">pm2 logs api</span><br><span class="line"></span><br><span class="line"># 显示应用api日志的 X 行</span><br><span class="line">pm2 logs big-api --lines 1000</span><br><span class="line"></span><br><span class="line"># 格式化日志显示</span><br><span class="line">pm2 logs --json pm2 logs --format</span><br><span class="line"></span><br><span class="line"># 应用启动指定显示方式 </span><br><span class="line">pm2 start --log-type json app.json</span><br><span class="line">pm2 start echo.js --merge-logs --log-date-format=&quot;YYYY-MM-DD HH:mm Z&quot;</span><br><span class="line"></span><br><span class="line"># 或者配置文件中中指定 &quot;log_type&quot;: &quot;json&quot;</span><br><span class="line"></span><br><span class="line"># 清除日志 （或者使用 pm2 install pm2-logrotate ）</span><br><span class="line">pm2 flush</span><br><span class="line"></span><br><span class="line"># 不记录日志信息</span><br><span class="line">&#123;</span><br><span class="line">  &quot;out_file&quot;: &quot;/dev/null&quot;,</span><br><span class="line">  &quot;error_file&quot;: &quot;/dev/null&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 指定日志类型</span><br><span class="line">pm2 logs main</span><br></pre></td></tr></table></figure>
<h3 id="更新PM2"><a href="#更新PM2" class="headerlink" title="更新PM2"></a>更新PM2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 保存当前进程信息</span><br><span class="line">pm2 save</span><br><span class="line"></span><br><span class="line"># 安装最新版pm2</span><br><span class="line">npm install pm2 -g</span><br><span class="line"></span><br><span class="line"># 在内存中更新pm2</span><br><span class="line">pm2 update</span><br></pre></td></tr></table></figure>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>本地我们可以直接通过 <code>pm2 start/stop</code>管理本地应用，通过deploy命令，在本地可以很轻松的将本地的应用部署远程服务器上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;apps&quot; : [&#123;</span><br><span class="line">      &quot;name&quot; : &quot;HTTP-API&quot;,</span><br><span class="line">      &quot;script&quot; : &quot;http.js&quot;</span><br><span class="line">   &#125;],</span><br><span class="line">   &quot;deploy&quot; : &#123;</span><br><span class="line">     // &quot;production&quot; is the environment name</span><br><span class="line">     &quot;production&quot; : &#123;</span><br><span class="line">        // 已授权的公钥路径</span><br><span class="line">        &quot;key&quot;  : &quot;/path/to/some.pem&quot;,           // 用户名</span><br><span class="line">       &quot;user&quot; : &quot;ubuntu&quot;,</span><br><span class="line">       // 主机</span><br><span class="line">       &quot;host&quot; : [&quot;212.83.163.1&quot;, &quot;212.83.163.2&quot;, &quot;212.83.163.3&quot;],</span><br><span class="line">       // 分支</span><br><span class="line">       &quot;ref&quot;  : &quot;origin/master&quot;,</span><br><span class="line">       // 代码库</span><br><span class="line">       &quot;repo&quot; : &quot;git@github.com:Username/repository.git&quot;,</span><br><span class="line">       // 远程服务器存放应用的路径</span><br><span class="line">       &quot;path&quot; : &quot;/var/www/my-repository&quot;,</span><br><span class="line">       // ssh 配置项 可以是字符串或者数组字符串</span><br><span class="line">       &quot;ssh_options&quot;: &quot;StrictHostKeyChecking=no&quot;,</span><br><span class="line">       // 安装依赖，可以是命令，多个命令用分号;分割，也可以用本地脚本文件的路径</span><br><span class="line">       &quot;pre-setup&quot; : &quot;apt-get install git&quot;,</span><br><span class="line">       // 代码库克隆完成执行 使用方式和 pre-setup一样</span><br><span class="line">       &quot;post-setup&quot;: &quot;ls -la&quot;,</span><br><span class="line">       // 本地要执行的代码</span><br><span class="line">       &quot;pre-deploy-local&quot; : &quot;echo &apos;This is a local executed command&apos;&quot;</span><br><span class="line">       // 代码库克隆完成,远程执行</span><br><span class="line">       &quot;post-deploy&quot; : &quot;npm install; grunt dist&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;dev&quot; : &#123;</span><br><span class="line">       &quot;user&quot; : &quot;ubuntu_dev&quot;,</span><br><span class="line">       &quot;host&quot; : [&quot;192.168.0.12&quot;],</span><br><span class="line">       &quot;ref&quot;  : &quot;origin/master&quot;,</span><br><span class="line">       &quot;repo&quot; : &quot;git@github.com:Username/repository.git&quot;,</span><br><span class="line">       &quot;path&quot; : &quot;/var/www/my-repository&quot;,</span><br><span class="line">       &quot;post-deploy&quot; : &quot;npm install; grunt dist&quot;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 本地生成公钥</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">ssh-copy-id node@myserver.com</span><br><span class="line"></span><br><span class="line"># 远程部署，初始化应用目录</span><br><span class="line">pm2 deploy production setup</span><br><span class="line"></span><br><span class="line"># 更新远程版本</span><br><span class="line">pm2 deploy production update</span><br><span class="line"></span><br><span class="line"># 版本回退 Revert to -1 deployment</span><br><span class="line">pm2 deploy production revert 1</span><br><span class="line"></span><br><span class="line"># 远程执行命令</span><br><span class="line">pm2 deploy production exec &quot;pm2 reload all&quot;</span><br><span class="line"></span><br><span class="line">pm2 startOrRestart all.json</span><br></pre></td></tr></table></figure>
<p><a href="http://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/" target="_blank" rel="noopener">Docker部署</a></p>
<h3 id="将pm2设置成系统服务"><a href="#将pm2设置成系统服务" class="headerlink" title="将pm2设置成系统服务"></a>将pm2设置成系统服务</h3><ul>
<li>systemd: Ubuntu &gt;= 16, CentOS &gt;= 7, Arch, Debian &gt;= 7</li>
<li>upstart: Ubuntu &lt;= 14</li>
<li>launchd: Darwin, MacOSx</li>
<li>openrc: Gentoo Linux, Arch Linux</li>
<li>rcd: FreeBSD</li>
<li>systemv: Centos 6, Amazon Linux</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pm2 startup</span><br><span class="line"></span><br><span class="line"># 指定具体平台,不加参数会自动检测</span><br><span class="line">pm2 startup [ubuntu | ubuntu14 | ubuntu12 | centos | centos6 | arch | oracle | amazon | macos | darwin | freebsd | systemd | systemv | upstart | launchd | rcd | openrc]</span><br><span class="line"></span><br><span class="line"># disable 自动启动</span><br><span class="line">pm2 unstartup</span><br><span class="line"></span><br><span class="line"># 保存当前进程列表</span><br><span class="line">pm2 save</span><br><span class="line"></span><br><span class="line"># 恢复之前保存的进程列表</span><br><span class="line">pm2 resurrect</span><br></pre></td></tr></table></figure>
<p>检测自启服务是否设置好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Check if pm2-&lt;USER&gt; service has been added</span><br><span class="line">$ systemctl list-units</span><br><span class="line"># Check logs</span><br><span class="line">$ journalctl -u pm2-&lt;USER&gt;</span><br><span class="line"># Cat systemd configuration file</span><br><span class="line">$ systemctl cat pm2-&lt;USER&gt;</span><br><span class="line"># Analyze startup</span><br><span class="line">$ systemd-analyze plot &gt; output.svg</span><br></pre></td></tr></table></figure>
<h3 id="自动重启服务"><a href="#自动重启服务" class="headerlink" title="自动重启服务"></a>自动重启服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 当前目录或子目录文件改动自动重启服务</span><br><span class="line">pm2 start app.js --watch</span><br><span class="line"></span><br><span class="line"># 不会停止检测文件改动</span><br><span class="line">pm2 stop 0 </span><br><span class="line"></span><br><span class="line"># 停止检测文件改动</span><br><span class="line">pm2 stop --watch 0 </span><br><span class="line"></span><br><span class="line"># 配置文件 详细配置检测文件路径</span><br><span class="line">&#123;</span><br><span class="line">  &quot;watch&quot;: [&quot;server&quot;, &quot;client&quot;],</span><br><span class="line">  &quot;ignore_watch&quot; : [&quot;node_modules&quot;, &quot;client/img&quot;],</span><br><span class="line">  &quot;watch_options&quot;: &#123;</span><br><span class="line">    &quot;followSymlinks&quot;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 监测cpu及memory</span><br><span class="line">pm2 monit</span><br></pre></td></tr></table></figure>
<h3 id="sourcemap"><a href="#sourcemap" class="headerlink" title="sourcemap"></a>sourcemap</h3><p>当使用babeljs,typescript时，有了sourcemap，异常了可以找到具体错误信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 命令行指定 </span><br><span class="line">pm2 start app.js --source-map-support</span><br><span class="line">pm2 start app.js --disable-source-map</span><br><span class="line"></span><br><span class="line"># 配置文件指定</span><br><span class="line">&#123;</span><br><span class="line">  &quot;apps&quot; : [&#123;</span><br><span class="line">    &quot;name&quot;              : &quot;my-app&quot;,</span><br><span class="line">    &quot;script&quot;            : &quot;script.js&quot;,</span><br><span class="line">    &quot;source_map_support&quot;: true</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="静态服务"><a href="#静态服务" class="headerlink" title="静态服务"></a>静态服务</h3><p>pm2 2.4.0 后可使用静态服务命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 命令行方式</span><br><span class="line">pm2 serve &lt;path&gt; &lt;port&gt;</span><br><span class="line"></span><br><span class="line"># 或者配置文件</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script&quot;: &quot;serve&quot;,</span><br><span class="line">  &quot;env&quot;: &#123;</span><br><span class="line">    &quot;PM2_SERVE_PATH&quot;: &apos;.&apos;,</span><br><span class="line">    &quot;PM2_SERVE_PORT&quot;: 8080</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><a href="http://pm2.keymetrics.io/docs/usage/process-metrics/#counter-sequential-value-change" target="_blank" rel="noopener">进程性能指标</a></li>
<li><a href="http://pm2.keymetrics.io/docs/usage/specifics/" target="_blank" rel="noopener">非root使用authbind绑定80端口</a></li>
<li><a href="http://pm2.keymetrics.io/docs/usage/pm2-api/" target="_blank" rel="noopener">pm2 api</a></li>
<li><a href="http://pm2.keymetrics.io/docs/usage/use-pm2-with-cloud-providers/" target="_blank" rel="noopener">云服务使用pm2</a></li>
<li><a href="http://pm2.keymetrics.io/docs/advanced/pm2-module-system/" target="_blank" rel="noopener">pm2模块</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/09/11/RN-真机调试及内部发布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/11/RN-真机调试及内部发布/" itemprop="url">[RN]真机调试及内部发布</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-11T01:15:47+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/react-native/" itemprop="url" rel="index">
                    <span itemprop="name">react native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一般我们开发RN都是在模拟器上调试的，那么真机是如何调试的呢？</p>
<h3 id="真机调试"><a href="#真机调试" class="headerlink" title="真机调试"></a>真机调试</h3><ol>
<li>配置好签名证书，并将包环境设置成Debug模式</li>
<li>将<code>AppDelegate.m</code>中的localhost修改成对应的IP地址，将调试真机插在电脑上，Xcode模拟器选择真机。</li>
<li>运行编译命令，真机摇一摇手机即可调出调试面板</li>
</ol>
<h3 id="内部发布"><a href="#内部发布" class="headerlink" title="内部发布"></a>内部发布</h3><p>内部发布是上App Store之前的一步，开发完RN项目后可供内部人员安装和使用</p>
<ol>
<li>修改<code>AppDelegate.m</code>中jsCodeLocation为 <code>jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;index.ios&quot; fallbackResource:nil];</code></li>
<li>在项目下运行 <code>curl http://localhost:8081/index.ios.bundle -o main.jsbundle</code><br>或者运行<code>react-native bundle</code></li>
</ol>
<p>此时就是在项目目录下生成<code>main.jsbundle</code>文件，这个文件将所有js文件都打包在一起了，然后配置好证书，再编译得到ipa离线包，安装后即可在真机跑起来了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/09/11/RN-修改包服务器端口/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/11/RN-修改包服务器端口/" itemprop="url">[RN]修改包服务器端口</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-11T00:38:23+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/react-native/" itemprop="url" rel="index">
                    <span itemprop="name">react native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开发React Native时，启动包服务器的默认端口是<code>8081</code>，如果跟现有服务器端口冲突的话，可以修改成想要的端口，修改内容如下：</p>
<h3 id="修改包服务器端口号"><a href="#修改包服务器端口号" class="headerlink" title="修改包服务器端口号"></a>修改包服务器端口号</h3><p>包服务器启动监听端口，在项目的<code>node_modules/react-native/local-cli/server/server.js中</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">options: [&#123;</span><br><span class="line">    command: <span class="string">'--port [number]'</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="number">8081</span>,</span><br><span class="line">    parse: <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">Number</span>(val),</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<p>由此可见我可以在运行时<code>react-native start --port=8082</code>动态指定端口</p>
<h3 id="修改应用程序启动时，读取逻辑代码的的地址"><a href="#修改应用程序启动时，读取逻辑代码的的地址" class="headerlink" title="修改应用程序启动时，读取逻辑代码的的地址"></a>修改应用程序启动时，读取逻辑代码的的地址</h3><p>在<code>ios/Demo01/AppDelegate.m</code>中找到下面代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 修改后代码</span><br><span class="line">  jsCodeLocation = [NSURL URLWithString:@&quot;http://localhost:8081/index.ios.bundle&quot;];</span><br><span class="line">// jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;index.ios&quot; fallbackResource:nil];</span><br></pre></td></tr></table></figure>
<h3 id="修改websocket监听端口"><a href="#修改websocket监听端口" class="headerlink" title="修改websocket监听端口"></a>修改websocket监听端口</h3><p>在项目的<code>node_modules/react-native/Libraries/WebSocket/RCTWebSocketExecutor</code>中修改下端口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)setUp</span><br><span class="line">&#123;</span><br><span class="line">  if (!_url) &#123;</span><br><span class="line">    NSInteger port = [[[_bridge bundleURL] port] integerValue] ?: 8081;</span><br><span class="line">    NSString *host = [[_bridge bundleURL] host] ?: @&quot;localhost&quot;;</span><br><span class="line">    NSString *URLString = [NSString stringWithFormat:@&quot;http://%@:%zd/debugger-proxy?role=client&quot;, host, port];</span><br><span class="line">    _url = [RCTConvert NSURL:URLString];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/08/17/next/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/next/" itemprop="url">next快速入门</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T20:16:53+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Next是react服务端渲染框架。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>默认服务端渲染</li>
<li>自动切分代码</li>
<li>基于webpack开发，支持HMR</li>
<li>可以集成Express或其他Node server</li>
<li>可以自定义Babel和Webpack配置</li>
</ul>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><h4 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir hello-next</span><br><span class="line"><span class="built_in">cd</span> hello-next</span><br><span class="line">npm init -y</span><br><span class="line">npm install --save react react-dom next</span><br><span class="line"><span class="comment"># pages是页面路由目录，必须有，路由默认是基于该目录下的文件</span></span><br><span class="line">mkdir pages</span><br></pre></td></tr></table></figure>
<p>npm script 添加如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"next"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// npm run dev 即可运行开发服务器 http://localhost:3000</span></span><br></pre></td></tr></table></figure>
<p>目前没有路由，访问会出现404页面，接下来添加路由。</p>
<h4 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h4><p>在pages目录下添加index.js(pages/index.js),内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Index = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure>
<blockquote>
<p>React组件要 <strong>默认</strong> 导出；默认情况下<code>pages</code>为路由目录，<code>static</code>为静态文件目录。</p>
</blockquote>
<h4 id="页面导航"><a href="#页面导航" class="headerlink" title="页面导航"></a>页面导航</h4><p>添加about页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;This is the about page&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>通过 <code>a</code> 标签可以很容易做到页面跳转，但那是通过服务端导航，不是我们想要的，我们可以通过 <code>next/link</code>支持客户端导航。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Link href=<span class="string">"/about"</span>&gt;</span><br><span class="line">      &lt;a&gt;About Page&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Link&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包裹按钮</span></span><br><span class="line">&lt;Link href=<span class="string">"/about"</span>&gt;</span><br><span class="line">  &lt;button&gt;Go to About Page&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Link&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Link组件包裹a标签，处理页面跳转，无论是a，button还是其他组件(比如div)，只要Link子组件接收onClick属性，都可以跳转。</p>
</blockquote>
<p>链接添加样式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生效</span></span><br><span class="line">&lt;Link href=<span class="string">"/about"</span>&gt;</span><br><span class="line">  &lt;a style=&#123;&#123; <span class="attr">fontSize</span>: <span class="number">20</span> &#125;&#125;&gt;About Page&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Link&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不生效</span></span><br><span class="line">&lt;Link href=<span class="string">"/about"</span> style=&#123;&#123; <span class="attr">fontSize</span>: <span class="number">20</span> &#125;&#125;&gt;</span><br><span class="line">  &lt;a&gt;About Page&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Link&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Link是高阶组件，直接收 href等一些其他属性，不支持style。</p>
</blockquote>
<h4 id="共享组件"><a href="#共享组件" class="headerlink" title="共享组件"></a>共享组件</h4><p>多个页面经常会有公用部分（比如Head），我们可以新建<code>components/Header.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> linkStyle = &#123;</span><br><span class="line">  marginRight: <span class="number">15</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Link href=<span class="string">"/"</span>&gt;</span><br><span class="line">          &lt;a style=&#123;linkStyle&#125;&gt;Home&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Link&gt;</span><br><span class="line">        &lt;Link href=<span class="string">"/about"</span>&gt;</span><br><span class="line">          &lt;a style=&#123;linkStyle&#125;&gt;About&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Link&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">export default Header</span></span><br></pre></td></tr></table></figure>
<p>在首页中导入<code>Head</code>组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'../components/Header'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &lt;p&gt;Hello Next.js&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>组件可以放在任何目录中，除了 <strong>pages</strong> 目录，pages下的文件跟服务端路由相关。</p>
</blockquote>
<h4 id="Layout组件"><a href="#Layout组件" class="headerlink" title="Layout组件"></a>Layout组件</h4><p>可以将整个页面框架做成layout组件(components/MyLayout.js)，各个页面复用</p>
<p>Layout组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./Header'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> layoutStyle = &#123;</span><br><span class="line">  margin: <span class="number">20</span>,</span><br><span class="line">  padding: <span class="number">20</span>,</span><br><span class="line">  border: <span class="string">'1px solid #DDD'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Layout = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;div style=&#123;layoutStyle&#125;&gt;</span><br><span class="line">    &lt;Header /&gt;</span><br><span class="line">    &#123;props.children&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Layout</span></span><br></pre></td></tr></table></figure>
<p>index页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">       &lt;p&gt;Hello Next.js&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>about页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pages/about.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">       &lt;p&gt;about&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>layout除了使用<code>{props.children}</code>还可以使用属性传值,高级组件的方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> withLayout <span class="keyword">from</span> <span class="string">'../lib/layout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Page = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;p&gt;This is the about page&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">export default withLayout(Page)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index.js</span></span><br><span class="line"><span class="keyword">const</span> Page = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;p&gt;This is the about page&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default () =&gt; (&lt;Layout page=&#123;Page&#125;/</span>&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="动态页面"><a href="#动态页面" class="headerlink" title="动态页面"></a>动态页面</h4><p>前边我们实现了静态页面，现在我们通过 query string 实现动态页面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PostLink = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;Link href=&#123;<span class="string">`/post?title=<span class="subst">$&#123;props.title&#125;</span>`</span>&#125;&gt;</span><br><span class="line">      &lt;a&gt;&#123;props.title&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Link&gt;</span><br><span class="line">  &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 通过Link组件href属性向下一个页面传参</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default () =&gt; (</span></span><br><span class="line"><span class="regexp">  &lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1&gt;My Blog&lt;/</span>h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;PostLink title=<span class="string">"Hello Next.js"</span>/&gt;</span><br><span class="line">      &lt;PostLink title=<span class="string">"Learn Next.js is awesome"</span>/&gt;</span><br><span class="line">      &lt;PostLink title=<span class="string">"Deploy apps with Zeit"</span>/&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Layout&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>处理查询参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">       &lt;h1&gt;&#123;props.url.query.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">       &lt;p&gt;This is the blog post content.&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>
<p>只有default导出的组件才有<code>url</code>属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Content = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;&#123;props.url.query.title&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;This is the blog post content.&lt;/</span>p&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">       &lt;Content /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 页面会抛出异常</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 可以通过组件传值的方式将url参数带到子组件中去</span></span><br><span class="line"><span class="regexp">&lt;Layout&gt;</span></span><br><span class="line"><span class="regexp">   &lt;Content url=&#123;props.url&#125; /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/Layout&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>每个页面都会获取<code>url</code>属性，可以<code>props.url.query.title</code>拿到相关的数据。</p>
</blockquote>
<h4 id="自定义路由"><a href="#自定义路由" class="headerlink" title="自定义路由"></a>自定义路由</h4><p>Link组件有个<code>as</code>属性，我们可以通过它自定义路由格式，它会显示在浏览器的地址栏中，但实际下个页面接收的数据还是href属性上的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PostLink = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;Link <span class="keyword">as</span>=&#123;<span class="string">`/p/<span class="subst">$&#123;props.id&#125;</span>`</span>&#125; href=&#123;<span class="string">`/post?title=<span class="subst">$&#123;props.title&#125;</span>`</span>&#125;&gt;</span><br><span class="line">      &lt;a&gt;&#123;props.title&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Link&gt;</span><br><span class="line">  &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>虽然可以自定义客户端路由显示，但是刷新页面可能会404,服务端没有对应的路由。</p>
</blockquote>
<h4 id="自定义服务器"><a href="#自定义服务器" class="headerlink" title="自定义服务器"></a>自定义服务器</h4><p>安装<code>Express</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save express</span><br></pre></td></tr></table></figure>
<p>根目录下创建<code>server.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> next = <span class="built_in">require</span>(<span class="string">'next'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dev = process.env.NODE_ENV !== <span class="string">'production'</span></span><br><span class="line"><span class="keyword">const</span> app = next(&#123; dev &#125;)</span><br><span class="line"><span class="keyword">const</span> handle = app.getRequestHandler()</span><br><span class="line"></span><br><span class="line">app.prepare()</span><br><span class="line">.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> server = express()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理对应路由</span></span><br><span class="line">  server.get(<span class="string">'/p/:id'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> actualPage = <span class="string">'/post'</span></span><br><span class="line">    <span class="comment">// 这里拿到的title是路由中的id,而客户端路由拿到的是Link href中的title，有点区别，但实际生产环境中都会使用资源id去请求数据。</span></span><br><span class="line">    <span class="keyword">const</span> queryParams = &#123; <span class="attr">title</span>: req.params.id &#125; </span><br><span class="line">    <span class="comment">// 定义了一个路由映射到已存在页面，同时附带查询参数</span></span><br><span class="line">    app.render(req, res, actualPage, queryParams)</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  server.get(<span class="string">'*'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> handle(req, res)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  server.listen(<span class="number">3000</span>, (err) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'&gt; Ready on http://localhost:3000'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">ex</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(ex.stack)</span><br><span class="line">  process.exit(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>更新下npm脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"node server.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="远程获取数据"><a href="#远程获取数据" class="headerlink" title="远程获取数据"></a>远程获取数据</h4><p>可以通过一个异步方法<code>getInitialProps</code>（同时支持客户端和服务端）来获取远程数据。</p>
<p>安装 <code>isomorphic-unfetch</code> 请求模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save isomorphic-unfetch</span><br></pre></td></tr></table></figure>
<p>修改首页内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"><span class="keyword">import</span> fetch <span class="keyword">from</span> <span class="string">'isomorphic-unfetch'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;Batman TV Shows&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;props.shows.map((&#123;show&#125;) =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;li key=&#123;show.id&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Link as=&#123;`/</span>p/$&#123;show.id&#125;<span class="string">`&#125; href=&#123;`</span>/post?id=$&#123;show.id&#125;<span class="string">`&#125;&gt;</span></span><br><span class="line"><span class="string">            &lt;a&gt;&#123;show.name&#125;&lt;/a&gt;</span></span><br><span class="line"><span class="string">          &lt;/Link&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">      ))&#125;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">  &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Post.getInitialProps = async function (context) &#123;</span></span><br><span class="line"><span class="string">  // 可以通过context上的query拿到查询参数</span></span><br><span class="line"><span class="string">  const &#123; id &#125; = context.query</span></span><br><span class="line"><span class="string">  const res = await fetch(`</span>https:<span class="comment">//api.tvmaze.com/shows/$&#123;id&#125;`)</span></span><br><span class="line">  <span class="keyword">const</span> show = <span class="keyword">await</span> res.json()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Fetched show: <span class="subst">$&#123;show.name&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; show &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</span><br></pre></td></tr></table></figure>
<p>getInitialProps receives a context object with the following properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pathname - path section of URL</span><br><span class="line">query - query string section of URL parsed as an object</span><br><span class="line">asPath - the actual url path</span><br><span class="line">req - HTTP request object (server only)</span><br><span class="line">res - HTTP response object (server only)</span><br><span class="line">jsonPageRes - Fetch Response object (client only)</span><br><span class="line">err - Error object if any error is encountered during the rendering</span><br></pre></td></tr></table></figure>
<h4 id="组件样式"><a href="#组件样式" class="headerlink" title="组件样式"></a>组件样式</h4><p>给组件添加样式有如下两种方法：</p>
<ul>
<li>外部引入css文件</li>
<li>css in js （next推荐）</li>
</ul>
<p>next.js使用 <a href="https://github.com/zeit/styled-jsx" target="_blank" rel="noopener">styled-jxs</a>控制局部样式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/MyLayout.js'</span></span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosts</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'hello-nextjs'</span>, <span class="attr">title</span>: <span class="string">'Hello Next.js'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'learn-nextjs'</span>, <span class="attr">title</span>: <span class="string">'Learn Next.js is awesome'</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">'deploy-nextjs'</span>, <span class="attr">title</span>: <span class="string">'Deploy apps with ZEIT'</span>&#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;h1&gt;My Blog&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">      &#123;getPosts().map((post) =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;li key=&#123;post.id&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Link as=&#123;`/</span>p/$&#123;post.id&#125;<span class="string">`&#125; href=&#123;`</span>/post?title=$&#123;post.title&#125;<span class="string">`&#125;&gt;</span></span><br><span class="line"><span class="string">            &lt;a&gt;&#123;post.title&#125;&lt;/a&gt;</span></span><br><span class="line"><span class="string">          &lt;/Link&gt;</span></span><br><span class="line"><span class="string">          &lt;!-- prefetch 会预加载下个页面的脚本，不会加载数据--&gt;</span></span><br><span class="line"><span class="string">          &lt;li&gt;&lt;Link prefetch href='/'&gt;&lt;a&gt;Home&lt;/a&gt;&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">      ))&#125;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;!-- 除了 Link 添加prefech属性，还可以通过脚本预加载--&gt;</span></span><br><span class="line"><span class="string">    &lt;a onClick=&#123; () =&gt; setTimeout(() =&gt; url.pushTo('/dynamic'), 100) &#125;&gt;</span></span><br><span class="line"><span class="string">      A route transition will happen after 100ms</span></span><br><span class="line"><span class="string">    &lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      // but we can prefetch it!</span></span><br><span class="line"><span class="string">      Router.prefetch('/dynamic')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // 样式必须用反引号包裹，必须放在模板字符串中，Styled jsx仅仅作为一个babel插件</span></span><br><span class="line"><span class="string">    &lt;style jsx&gt;&#123;`</span></span><br><span class="line">      h1, a &#123;</span><br><span class="line">        font-family: <span class="string">"Arial"</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      ul &#123;</span><br><span class="line">        padding: <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      li &#123;</span><br><span class="line">        list-style: none;</span><br><span class="line">        margin: <span class="number">5</span>px <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      a &#123;</span><br><span class="line">        text-decoration: none;</span><br><span class="line">        color: blue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      a:hover &#123;</span><br><span class="line">        opacity: <span class="number">0.6</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="string">`&#125;&lt;/style&gt;</span></span><br><span class="line"><span class="string">  &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>styled-jsx 样式默认不作用于子组件，如果要子组件生效，可以单独定义子组件样式，或者使用全局样式。</p>
</blockquote>
<p><code>styled-jsx</code> 全局样式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;style jsx global&gt;&#123;<span class="string">`</span></span><br><span class="line"><span class="string">     .markdown &#123;</span></span><br><span class="line"><span class="string">       font-family: 'Arial';</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     .markdown a &#123;</span></span><br><span class="line"><span class="string">       text-decoration: none;</span></span><br><span class="line"><span class="string">       color: blue;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     .markdown a:hover &#123;</span></span><br><span class="line"><span class="string">       opacity: 0.6;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     .markdown h3 &#123;</span></span><br><span class="line"><span class="string">       margin: 0;</span></span><br><span class="line"><span class="string">       padding: 0;</span></span><br><span class="line"><span class="string">       text-transform: uppercase;</span></span><br><span class="line"><span class="string">     &#125;</span></span><br><span class="line"><span class="string">  `</span>&#125;&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="应用部署"><a href="#应用部署" class="headerlink" title="应用部署"></a>应用部署</h3><h4 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h4><ol>
<li>build代码</li>
<li>启动服务</li>
</ol>
<p>修改下npm脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"next build"</span>,</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"next start"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="启动多个服务"><a href="#启动多个服务" class="headerlink" title="启动多个服务"></a>启动多个服务</h4><p>为了水平扩展，通常会使用多个app实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$PORT 为环境变量</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"next start -p $PORT"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//window下用 "next start -p %PORT%"</span></span><br></pre></td></tr></table></figure>
<p>调用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PORT=8000 npm start</span><br><span class="line">PORT=9000 npm start</span><br></pre></td></tr></table></figure></p>
<p>可以通过 <a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener">cross-env</a> 设置环境变量。</p>
<h3 id="高阶使用"><a href="#高阶使用" class="headerlink" title="高阶使用"></a>高阶使用</h3><h4 id="导出静态网站"><a href="#导出静态网站" class="headerlink" title="导出静态网站"></a>导出静态网站</h4><p>在根目录下创建文件<code>next.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  exportPathMap: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">'/'</span>: &#123; <span class="attr">page</span>: <span class="string">'/'</span> &#125;,</span><br><span class="line">      <span class="string">'/about'</span>: &#123; <span class="attr">page</span>: <span class="string">'/about'</span> &#125;,</span><br><span class="line">      <span class="string">'/p/hello-nextjs'</span>: &#123; <span class="attr">page</span>: <span class="string">'/post'</span>, <span class="attr">query</span>: &#123; <span class="attr">title</span>: <span class="string">"Hello Next.js"</span> &#125; &#125;,</span><br><span class="line">      <span class="string">'/p/learn-nextjs'</span>: &#123; <span class="attr">page</span>: <span class="string">'/post'</span>, <span class="attr">query</span>: &#123; <span class="attr">title</span>: <span class="string">"Learn Next.js is awesome"</span> &#125; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改npm脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"next build"</span>,</span><br><span class="line">    <span class="string">"export"</span>: <span class="string">"next export"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行导出命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run <span class="built_in">export</span></span><br></pre></td></tr></table></figure>
<p>导入内容会放在<code>out</code>目录中，可放在任何静态服务器上使用。</p>
<p>☞<a href="https://github.com/zeit/next.js#custom-server-and-routing" target="_blank" rel="noopener">官网</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/08/15/Hexo插入媒体资源/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/15/Hexo插入媒体资源/" itemprop="url">Hexo插入媒体资源</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-15T00:59:44+08:00">
                2017-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通常我们会在Hexo文章中插入媒体资源如图片，音频，视频，那么让我们来看看如何插入</p>
<h3 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h3><h4 id="本地图片"><a href="#本地图片" class="headerlink" title="本地图片"></a>本地图片</h4><p>在/hexo/source目录下新建文件夹，命名为images或其他</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">图片描述</span>](<span class="link">/images/图片名字.png</span>)</span><br></pre></td></tr></table></figure>
<h4 id="使用远程图片"><a href="#使用远程图片" class="headerlink" title="使用远程图片"></a>使用远程图片</h4><p>这种是大家常用的方法<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">图片描述</span>](<span class="link">http://ouonaooa5.bkt.clouddn.com/demo.jpg</span>)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>可使用七牛存储自己的图片资源</p>
</blockquote>
<h3 id="插入音频"><a href="#插入音频" class="headerlink" title="插入音频"></a>插入音频</h3><h4 id="插入网易云音乐"><a href="#插入网易云音乐" class="headerlink" title="插入网易云音乐"></a>插入网易云音乐</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">frameborder</span>=<span class="string">"no"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">marginwidth</span>=<span class="string">"0"</span> <span class="attr">marginheight</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">330</span> <span class="attr">height</span>=<span class="string">86</span>   </span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"//music.163.com/outchain/player?type=2&amp;id=25706282&amp;auto=0&amp;height=66"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=25706282&auto=0&height=66"><br></iframe> 


<h4 id="插入喜马拉雅"><a href="#插入喜马拉雅" class="headerlink" title="插入喜马拉雅"></a>插入喜马拉雅</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">"36"</span> <span class="attr">width</span>=<span class="string">"260"</span> <span class="attr">src</span>=<span class="string">"//www.ximalaya.com/swf/sound/red.swf?id=36371956"</span> <span class="attr">frameborder</span>=<span class="string">0</span> <span class="attr">allowfullscreen</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<object type="application/x-shockwave-flash" id="ximalaya_player" data="//www.ximalaya.com/swf/sound/red.swf?id=36371956" width="260" height="36"></object>


<h3 id="插入视频"><a href="#插入视频" class="headerlink" title="插入视频"></a>插入视频</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">class</span>=<span class="string">"ql-video ql-align-center"</span> <span class="attr">frameborder</span>=<span class="string">"0"</span> <span class="attr">allowfullscreen</span>=<span class="string">"true"</span> <span class="attr">src</span>=<span class="string">"https://www.youtube.com/embed/QHH3iSeDBLo?showinfo=0"</span> <span class="attr">height</span>=<span class="string">"238"</span> <span class="attr">width</span>=<span class="string">"560"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<iframe class="ql-video ql-align-center" frameborder="0" allowfullscreen="true" src="https://www.youtube.com/embed/QHH3iSeDBLo?showinfo=0" height="238" width="560"></iframe>






          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/08/15/Handlebars模板使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/15/Handlebars模板使用/" itemprop="url">Handlebars模板使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-15T00:09:36+08:00">
                2017-08-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://handlebarsjs.com/" target="_blank" rel="noopener">Handlebars</a> 是 JavaScript 一个语义模板库，通过对view和data的分离来快速构建Web模板。</p>
<p><img src="http://ouonaooa5.bkt.clouddn.com/handlebarjs.jpg" alt=""></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>直接下载 <a href="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v4.0.10.js" target="_blank" rel="noopener">Handlebars.js</a> 和 <a href="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars.runtime-v4.0.10.js" target="_blank" rel="noopener">Handlebar Runtime</a></li>
<li>通过npm下载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install --save handlebars</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引用</span></span><br><span class="line">require(<span class="string">'handlebars'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果模板预编译后,可直接使用运行时环境</span></span><br><span class="line">require(<span class="string">'handlebars/runtime'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><h4 id="Handlebar表达式"><a href="#Handlebar表达式" class="headerlink" title="Handlebar表达式"></a>Handlebar表达式</h4><p>Handlebars会从当前上下文中查找title和body属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"entry"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line">    &#123;&#123;body&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="路径查询"><a href="#路径查询" class="headerlink" title="路径查询"></a>路径查询</h4><p>Handlebars会从当前上下文中查找article属性,然后在查找结果中找title属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;article.title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 两者等价，下面方法deprecated--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;article/title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>标识符不能包含 Whitespace ! “ # % &amp; ‘ ( ) * + , . / ; &lt; = &gt; @ [ \ ] ^ ` { | } ~</p>
</blockquote>
<p>如果出现不合法的属性，可以使用中括号的方式进行引用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#each articles.[10].[#comments]&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;subject&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;&#123;body&#125;&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认情况下 Handlebars为了安全，会对内容进行转义，如需原样输出可以使用`{{{ html }}}`</p>
</blockquote>
<h4 id="Helper模板方法"><a href="#Helper模板方法" class="headerlink" title="Helper模板方法"></a>Helper模板方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#123;link story&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'link'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">object, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> url = Handlebars.escapeExpression(object.url),</span><br><span class="line">      text = Handlebars.escapeExpression(object.text);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Handlebars.SafeString(</span><br><span class="line">    <span class="string">"&lt;a href='"</span> + url + <span class="string">"'&gt;"</span> + text + <span class="string">"&lt;/a&gt;"</span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Handlebars helper支持接收一个可选的键值对参数作为它的最后一个参数传入(hash)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#123;link <span class="string">"See more..."</span> href=story.url <span class="class"><span class="keyword">class</span></span>=<span class="string">"story"</span>&#125;&#125;&#125;</span><br><span class="line">Handlebars.registerHelper(<span class="string">'link'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">text, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> attrs = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> options.hash) &#123;</span><br><span class="line">    attrs.push(</span><br><span class="line">        Handlebars.escapeExpression(prop) + <span class="string">'="'</span></span><br><span class="line">        + Handlebars.escapeExpression(options.hash[prop]) + <span class="string">'"'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Handlebars.SafeString(</span><br><span class="line">    <span class="string">"&lt;a "</span> + attrs.join(<span class="string">" "</span>) + <span class="string">"&gt;"</span> + Handlebars.escapeExpression(text) + <span class="string">"&lt;/a&gt;"</span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Helper 支持嵌套</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;outer-helper (inner-helper 'abc') 'def'&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="去掉空格"><a href="#去掉空格" class="headerlink" title="去掉空格"></a>去掉空格</h4><p>去掉多余空格(在大括号边添加 ~)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#each nav ~&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url&#125;&#125;"</span>&gt;</span></span><br><span class="line">    &#123;&#123;~#if test&#125;&#125;</span><br><span class="line">      &#123;&#123;~title&#125;&#125;</span><br><span class="line">    &#123;&#123;~^~&#125;&#125;</span><br><span class="line">      Empty</span><br><span class="line">    &#123;&#123;~/if~&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;&#123;~/each&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="标签转义"><a href="#标签转义" class="headerlink" title="标签转义"></a>标签转义</h4><p>使用标签原内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在前边添加 \ --&gt;</span></span><br><span class="line">\&#123;&#123;escaped&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--使用4个大括号--&gt;</span></span><br><span class="line">&#123;&#123;&#123;&#123;raw&#125;&#125;&#125;&#125;</span><br><span class="line">  &#123;&#123;escaped&#125;&#125;</span><br><span class="line">&#123;&#123;&#123;&#123;/raw&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编译模板"><a href="#编译模板" class="headerlink" title="编译模板"></a>编译模板</h3><h4 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"entry-template"</span> <span class="attr">type</span>=<span class="string">"text/x-handlebars-template"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"entry"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="javascript">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"body"</span>&gt;</span></span><br><span class="line"><span class="undefined">      &#123;&#123;body&#125;&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用 <code>Handlebars.compile</code>编译模板输出模板函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source   = $(<span class="string">"#entry-template"</span>).html();</span><br><span class="line"><span class="keyword">var</span> template = Handlebars.compile(source);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果预先生成模板函数了，则可以直接引用runtime库，不必将handlebar全部引入</span></span><br></pre></td></tr></table></figure>
<h4 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install handlebars -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 语法 </span></span><br><span class="line">handlebars &lt;input&gt; -f &lt;output&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看更多使用方法</span></span><br><span class="line">handlebars --<span class="built_in">help</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#如果输入文件是 person.handlebars，Handlebar会将文件内容作为compile方法的第一个参数，生成一个模板方法，插入到 Handlebars.templates.person上，之后可直接使用 Handlebars.templates.person(context,options)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若预编译，直接使用runtime库 &lt;script src="/libs/handlebars.runtime.js"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="高级使用"><a href="#高级使用" class="headerlink" title="高级使用"></a>高级使用</h3><h4 id="complile-函数"><a href="#complile-函数" class="headerlink" title="complile 函数"></a>complile 函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">模板函数接收第二个可选参数，传以下参数:</span><br><span class="line">data:传入私有变量 @variable </span><br><span class="line">helpers:传入局部helper，而不是全局定义，重名会覆盖全局。</span><br><span class="line">partials: 自定义模板片段partials，与helper类似</span><br></pre></td></tr></table></figure>
<h4 id="块级表达式"><a href="#块级表达式" class="headerlink" title="块级表达式"></a>块级表达式</h4><p>块级表达式可以改变模板局部context，块级helper以#开口，结尾以/开发，如`{{#hi}} {{/hi}}`</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"entry"</span>&gt;</span><br><span class="line">  &lt;h1&gt;&#123;&#123;title&#125;&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  &lt;div class="body"&gt;</span></span><br><span class="line"><span class="regexp">    &#123;&#123;#bold&#125;&#125;&#123;&#123;body&#125;&#125;&#123;&#123;/</span>bold&#125;&#125;</span><br><span class="line">    &#123;&#123;#noop&#125;&#125; hello &#123;&#123;/noop&#125;&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'noop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> options.fn(<span class="keyword">this</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 其中this执行当前上下文 options.fn 就像普通的模板函数一样，如果块级helper含有else部分，和fn类似的还有一个 options.reverse 渲染else里的模板。</span></span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'bold'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Handlebars.SafeString(</span><br><span class="line">      <span class="string">'&lt;div class="mybold"&gt;'</span></span><br><span class="line">      + options.fn(<span class="keyword">this</span>)</span><br><span class="line">      + <span class="string">'&lt;/div&gt;'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- <span class="keyword">with</span> 会改变当前上下文 --&gt;</span><br><span class="line">&#123;&#123;#with story&#125;&#125;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"intro"</span>&gt;&#123;&#123;&#123;intro&#125;&#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;div class="body"&gt;&#123;&#123;&#123;body&#125;&#125;&#125;&lt;/</span>div&gt;</span><br><span class="line">&#123;&#123;/<span class="keyword">with</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- 使用each 迭代 --&gt;</span><br><span class="line">&#123;&#123;#each comments&#125;&#125;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"comment"</span>&gt;</span><br><span class="line">  &lt;h2&gt;&#123;&#123;subject&#125;&#125;&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">  &#123;&#123;&#123;body&#125;&#125;&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// each 原理</span></span><br><span class="line">Handlebars.registerHelper(<span class="string">'each'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">context, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ret = <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>, j=context.length; i&lt;j; i++) &#123;</span><br><span class="line">    ret = ret + options.fn(context[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- 条件渲染 --&gt;</span><br><span class="line">&#123;&#123;#if isActive&#125;&#125;</span><br><span class="line">  &lt;img src=<span class="string">"star.gif"</span> alt=<span class="string">"Active"</span>&gt;</span><br><span class="line">&#123;&#123;<span class="keyword">else</span>&#125;&#125;</span><br><span class="line">  &lt;img src=<span class="string">"cry.gif"</span> alt=<span class="string">"Inactive"</span>&gt;</span><br><span class="line">&#123;&#123;/<span class="keyword">if</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'if'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">conditional, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(conditional) &#123;</span><br><span class="line">    <span class="keyword">return</span> options.fn(<span class="keyword">this</span>);  </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> options.inverse(<span class="keyword">this</span>);  <span class="comment">// 使用else里边的模板</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- hash 参数 --&gt;</span><br><span class="line">&#123;&#123;#list nav id="nav-bar" class="top"&#125;&#125;</span><br><span class="line">  &lt;a href=<span class="string">"&#123;&#123;url&#125;&#125;"</span>&gt;&#123;&#123;title&#125;&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&#123;&#123;/</span>list&#125;&#125;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'list'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">context, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> attrs = Em.keys(options.hash).map(<span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> key + <span class="string">'="'</span> + options.hash[key] + <span class="string">'"'</span>;</span><br><span class="line">  &#125;).join(<span class="string">" "</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">"&lt;ul "</span> + attrs + <span class="string">"&gt;"</span> + context.map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"&lt;li&gt;"</span> + options.fn(item) + <span class="string">"&lt;/li&gt;"</span>;</span><br><span class="line">  &#125;).join(<span class="string">"\n"</span>) + <span class="string">"&lt;/ul&gt;"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- block helper 支持向子模板里注入自己的私有变量，如@index --&gt;</span><br><span class="line">&#123;&#123;#list array&#125;&#125;</span><br><span class="line">  &#123;&#123;@index&#125;&#125;. &#123;&#123;title&#125;&#125;</span><br><span class="line">&#123;&#123;/list&#125;&#125;</span><br><span class="line">Handlebars.registerHelper(<span class="string">'list'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">context, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> out = <span class="string">"&lt;ul&gt;"</span>, data;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (options.data) &#123;</span><br><span class="line">    data = Handlebars.createFrame(options.data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;context.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      data.index = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    out += <span class="string">"&lt;li&gt;"</span> + options.fn(context[i], &#123; <span class="attr">data</span>: data &#125;) + <span class="string">"&lt;/li&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  out += <span class="string">"&lt;/ul&gt;"</span>;</span><br><span class="line">  <span class="keyword">return</span> out;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问父作用域中的index 可以使用 @../index</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Handlebars 3.0 部分内置helper 支持命名参数  user为当前this,userId为index</span></span><br><span class="line">&#123;&#123;#each users as |user userId|&#125;&#125;</span><br><span class="line">  Id: &#123;&#123;userId&#125;&#125; Name: &#123;&#123;user.name&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'block-params'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> args = [],</span><br><span class="line">      options = <span class="built_in">arguments</span>[<span class="built_in">arguments</span>.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    args.push(<span class="built_in">arguments</span>[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> options.fn(<span class="keyword">this</span>, &#123;<span class="attr">data</span>: options.data, <span class="attr">blockParams</span>: args&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#123;&#123;#block-params 1 2 3 as |foo bar baz|&#125;&#125;</span><br><span class="line">  &#123;&#123;foo&#125;&#125; &#123;&#123;bar&#125;&#125; &#123;&#123;baz&#125;&#125;</span><br><span class="line">&#123;&#123;/block-params&#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- 纯渲染，不做任何处理 --&gt;</span><br><span class="line">&#123;&#123;&#123;&#123;raw-helper&#125;&#125;&#125;&#125;</span><br><span class="line">  &#123;&#123;bar&#125;&#125;</span><br><span class="line">&#123;&#123;&#123;&#123;/raw-helper&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="路径查找"><a href="#路径查找" class="headerlink" title="路径查找"></a>路径查找</h4><p>可以通过 `../name` 或者`{{./name}} or {{this/name}} or {{this.name}}`</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;permalink&#125;&#125;</span><br><span class="line">&#123;&#123;#each comments&#125;&#125;</span><br><span class="line">  &#123;&#123;../permalink&#125;&#125;</span><br><span class="line"></span><br><span class="line">  &#123;&#123;#if title&#125;&#125;</span><br><span class="line">    &#123;&#123;../permalink&#125;&#125;</span><br><span class="line">  &#123;&#123;/if&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="comment">&lt;!-- permalink 查找上级作用域中的Permalink属性 --&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="模板注释"><a href="#模板注释" class="headerlink" title="模板注释"></a>模板注释</h4><p>使用`{{!-- --}} or {{! }}`注释内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;!-- This comment will not be in the output --&#125;&#125; </span><br><span class="line"></span><br><span class="line">&#123;&#123;! This comment will not be in the output &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Helper"><a href="#Helper" class="headerlink" title="Helper"></a>Helper</h4><p>使用 <code>Handlebars.registerHelper</code>注册模板助手</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Handlebars.registerHelper(<span class="string">'fullName'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> person.firstName + <span class="string">" "</span> + person.lastName;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'agree_button'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> emotion = Handlebars.escapeExpression(<span class="keyword">this</span>.emotion),</span><br><span class="line">      name = Handlebars.escapeExpression(<span class="keyword">this</span>.name);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不需要转义内容，使用Handlebars.SafeString </span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Handlebars.SafeString(</span><br><span class="line">    <span class="string">"&lt;button&gt;I agree. I "</span> + emotion + <span class="string">" "</span> + name + <span class="string">"&lt;/button&gt;"</span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(<span class="string">'if'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">conditional, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(conditional) &#123;</span><br><span class="line">    <span class="keyword">return</span> options.fn(<span class="keyword">this</span>);  </span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> options.inverse(<span class="keyword">this</span>);  <span class="comment">// 使用else里边的模板</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="模板片段Partials"><a href="#模板片段Partials" class="headerlink" title="模板片段Partials"></a>模板片段Partials</h4><p>使用 <code>Handlebars.registerPartial</code>注册模板片段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Handlebars.registerPartial(<span class="string">'myPartial'</span>, <span class="string">'&#123;&#123;name&#125;&#125;'</span>)</span><br></pre></td></tr></table></figure>
<p>使用`{{> myPartial }}`调用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  &#123;&#123;&gt; userMessage tagName="h1" &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comments<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态模板片段 --&gt;</span></span><br><span class="line">&#123;&#123;&gt; (whichPartial) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 更改上下文 --&gt;</span></span><br><span class="line">&#123;&#123;&gt; myPartial myOtherContext &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- hash 参数，模板中可直接使用该参数--&gt;</span></span><br><span class="line">&#123;&#123;&gt; myPartial parameter=value &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Partial Blocks  如果partial 没有注册就直接调用，就会抛出异常，使用块级helper可解决 --&gt;</span></span><br><span class="line">&#123;&#123;#&gt; myPartial &#125;&#125;</span><br><span class="line">  Failover content    &#123;&#123;! myPartial 没有注册时才渲染 &#125;&#125;</span><br><span class="line">&#123;&#123;/myPartial&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 可以通过@partial-block拿到默认内容 --&gt;</span></span><br><span class="line">&#123;&#123;#&gt; layout &#125;&#125;</span><br><span class="line">  My Content</span><br><span class="line">&#123;&#123;/layout&#125;&#125;</span><br><span class="line"></span><br><span class="line">Site Content</span><br><span class="line">&#123;&#123;&gt; @partial-block &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模板内声明partial，当前block和子模板中可用 --&gt;</span></span><br><span class="line">&#123;&#123;#*inline "myPartial"&#125;&#125;</span><br><span class="line">  My Content</span><br><span class="line">&#123;&#123;/inline&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;#each children&#125;&#125;</span><br><span class="line">  &#123;&#123;&gt; myPartial&#125;&#125;</span><br><span class="line">&#123;&#123;/each&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="内置Helper"><a href="#内置Helper" class="headerlink" title="内置Helper"></a>内置Helper</h4><p><code>if</code> 如果值为 <code>false, undefined, null, &quot;&quot;, 0, or []</code> 就会渲染else部分</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"entry"</span>&gt;</span></span><br><span class="line">  &#123;&#123;#if author&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;else&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Unknown Author<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  &#123;&#123;/if&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>unless</code> 相当于<code>if</code>的else情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;#unless license&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"warning"</span>&gt;</span>WARNING: This entry does not have a license!<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">&#123;&#123;/unless&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><code>each</code>遍历数组，会改变当前context，执行遍历的元素</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"people_list"</span>&gt;</span></span><br><span class="line">  &#123;&#123;#each people&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;this&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  &#123;&#123;else&#125;&#125;</span><br><span class="line">    暂无数据</span><br><span class="line">  &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p> 遍历对象，相当于变量的key;遍历数组，为array的index</p>
</blockquote>
<p><code>with</code> 会改变当前context</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"entry"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  &#123;&#123;#with author&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>By &#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  &#123;&#123;else&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"empty"</span>&gt;</span>No content<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  &#123;&#123;/with&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">`log` 渲染时打印日志</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&#123;&#123;log "Look at me!"&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- level 支持的值为 debug, info, warn, and error --&gt;</span></span><br><span class="line">&#123;&#123;log "Log!" level="error"&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>处理helper异常<br>如果调用一个不存在的helper，就会异常，<code>options.name</code>会自动注入为helper名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Handlebars.registerHelper(<span class="string">'helperMissing'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="regexp">/* [args, ] options */</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> options = <span class="built_in">arguments</span>[<span class="built_in">arguments</span>.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> Handlebars.Exception(<span class="string">'Unknown field: '</span> + options.name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册 partial</span></span><br><span class="line">Handlebars.registerPartial(<span class="string">'foo'</span>, partial);</span><br><span class="line"></span><br><span class="line">Handlebars.registerPartial(&#123;</span><br><span class="line">  foo: partial,</span><br><span class="line">  bar: partial</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 注销 partial</span></span><br><span class="line">Handlebars.unregisterPartial(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册 helper</span></span><br><span class="line">Handlebars.registerHelper(<span class="string">'foo'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Handlebars.registerHelper(&#123;</span><br><span class="line">  foo: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 注销helper</span></span><br><span class="line">Handlebars.unregisterHelper(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建块级作用域 child data</span></span><br><span class="line">Handlebars.createFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顶级对象</span></span><br><span class="line">@root </span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组第一个元素</span></span><br><span class="line">@first</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组最后一个元素</span></span><br><span class="line">@last</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象的key</span></span><br><span class="line">@key</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组的index</span></span><br><span class="line">@index</span><br></pre></td></tr></table></figure>
<p><a href="http://handlebarsjs.com/reference.html" target="_blank" rel="noopener">API更多请参考</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/04/26/sed常用操作命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/sed常用操作命令/" itemprop="url">sed常用操作命令</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-26T20:46:08+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="SED命令"><a href="#SED命令" class="headerlink" title="SED命令"></a>SED命令</h4><p>SED的英文全称是 Stream EDitor，它是一个简单而强大的文本解析转换工具。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ol>
<li>读一行到缓存区处理（模式空间）</li>
<li>执行sed命令</li>
<li>输出结果接着继续处理下一行（重复此流程直至结束）</li>
</ol>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><ul>
<li>文本替换</li>
<li>选择性的输出文本文件</li>
<li>从文本文件的某处开始编辑</li>
<li>无交互式的对文本文件进行编辑等</li>
</ul>
<h4 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sed [option]  command files</span><br><span class="line">option:</span><br><span class="line">    -e:指定要执行的命令，使用该参数，我们可以指定多个命令</span><br><span class="line">    -n:默认情况下，模式空间中的内容在处理完成后将会打印到标准输出，该选项用于阻止该行为</span><br><span class="line">    -f:指定包含要执行的命令的脚本文件(一行一个命令,类似多个-e)</span><br><span class="line">    </span><br><span class="line">command：行定位（或正则）+ sed命令 （命令使用单引号包裹）</span><br><span class="line"></span><br><span class="line">sed -e '1d' -e '2d' -e '5d' demo.txt</span><br></pre></td></tr></table></figure>
<p>在SED中使用的命令会作用于文本数据的所有行。如果只想将命令作用于特定的行或者某些行，则需要使用 “行寻址” 功能。</p>
<h5 id="行寻址两种形式："><a href="#行寻址两种形式：" class="headerlink" title="行寻址两种形式："></a>行寻址两种形式：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.以数字形式表示的行区间</span><br><span class="line">sed -n &apos;3p&apos; demo.txt </span><br><span class="line"></span><br><span class="line"># 区间 </span><br><span class="line">sed -n &apos;2,5 p&apos; demo.txt </span><br><span class="line"></span><br><span class="line"># $ 表示自后一行 ^ 标识开始</span><br><span class="line">sed -n &apos;3,$ p&apos; demo.txt</span><br><span class="line"></span><br><span class="line">2.以文本模式来过滤行</span><br><span class="line">sed -n &apos;/Alchemist/, 5 p&apos; books.txt</span><br></pre></td></tr></table></figure>
<h5 id="操作符"><a href="#操作符" class="headerlink" title="操作符 + , ~"></a>操作符 + , ~</h5><p>加号（+）操作符，它可以与逗号（,）操作符一起使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 从第二行开始下4行</span><br><span class="line">sed -n &apos;2,+4 p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<p>使用波浪线操作符（~）指定地址范围，它使用M~N（步长）的形式，告诉SED应该处理M行开始的每N行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 50~5匹配行号5，10，15等</span><br><span class="line">sed -n &apos;5~5 p&apos; demo.txt &gt; a.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>sed操作不影响源文件，可用重定向覆写源文件.</p>
</blockquote>
<h4 id="sed操作命令"><a href="#sed操作命令" class="headerlink" title="sed操作命令"></a>sed操作命令</h4><h5 id="打印命令-p"><a href="#打印命令-p" class="headerlink" title="打印命令 p"></a>打印命令 <code>p</code></h5><p>打印命令p通常和-n选项配合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 打印1~10行</span><br><span class="line">sed -n &apos;1,10p&apos; demo.txt</span><br><span class="line"></span><br><span class="line"># 打印非10行 </span><br><span class="line">sed -n &apos;10!p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="插入命令-a-i"><a href="#插入命令-a-i" class="headerlink" title="插入命令 a/i"></a>插入命令 <code>a/i</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 第五行后插入hello</span><br><span class="line">sed -n &apos;5a hello&apos; demo.txt</span><br><span class="line"></span><br><span class="line"># 第五行前插入hello</span><br><span class="line">sed -n &apos;5i hello&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="替代-c"><a href="#替代-c" class="headerlink" title="替代 c"></a>替代 <code>c</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 第四行替换成hi</span><br><span class="line">sed -n &apos;4c hi&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="删除-d"><a href="#删除-d" class="headerlink" title="删除 d"></a>删除 <code>d</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 删除第十行</span><br><span class="line">sed -n &apos;10d&apos; demo.txt </span><br><span class="line"></span><br><span class="line"># 删除空行</span><br><span class="line">sed &apos;^&amp;d&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="替换-s"><a href="#替换-s" class="headerlink" title="替换 s"></a>替换 <code>s</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># false 替换成true</span><br><span class="line">sed &apos;s/false/true/g&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="执行多条命令-；"><a href="#执行多条命令-；" class="headerlink" title="执行多条命令 { ；}"></a>执行多条命令 <code>{ ；}</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 多条命令使用&#123;&#125;，命令间用分号分隔</span><br><span class="line">sed -n &apos;&#123;p;n;p&#125;&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="读取下一行到模式空间里去-n"><a href="#读取下一行到模式空间里去-n" class="headerlink" title="读取下一行到模式空间里去 n"></a>读取下一行到模式空间里去 <code>n</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># false 替换成true</span><br><span class="line">sed &apos;s/false/true/g&apos; demo.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>h: 将当前模式空间的内容保存到保存空间<br>H：将当前模式空间中的内容追加到 保持空间<br>g : 将保持空间复制到模式空间<br>G: 将保持空间附加到模式空间<br>x：用于交换模式空间和保持空间中的内容</p>
</blockquote>
<h5 id="跳转-b"><a href="#跳转-b" class="headerlink" title="跳转 b"></a>跳转 <code>b</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 类似goto跳转</span><br><span class="line">sed -n &apos;h;n;H;x;s/\n/, /;/Paulo/!b Print; s/^/- /; :Print;p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="创建分支-t"><a href="#创建分支-t" class="headerlink" title="创建分支 t"></a>创建分支 <code>t</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 创建分支;只有当前置条件成功的时候，t 命令才会跳转到该标签</span><br><span class="line">sed -n &apos;h;n;H;x; s/\n/, /; :Loop;/Paulo/s/^/-/; /----/!t Loop; p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="替换字符-amp"><a href="#替换字符-amp" class="headerlink" title="替换字符 &amp;"></a>替换字符 <code>&amp;</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &amp; 为匹配的字符</span><br><span class="line">sed &apos;s/w/&amp;123&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="大小写转化-u-U-l-L"><a href="#大小写转化-u-U-l-L" class="headerlink" title="大小写转化 \u \U \l \L"></a>大小写转化 <code>\u \U \l \L</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &amp; 为匹配的字符</span><br><span class="line">sed &apos;s/w/\u&amp;123/&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="字符一对一转化-y"><a href="#字符一对一转化-y" class="headerlink" title="字符一对一转化 y"></a>字符一对一转化 <code>y</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># [address]y/inchars/outchars/ </span><br><span class="line"># inchars中的第一个字符会被转换为outchars中的第一个字符，第二个字符会被转换成outchars中的第二个字符</span><br><span class="line">$ echo &quot;1 5 15 20&quot; | sed &apos;y/151520/IVXVXX/&apos;</span><br></pre></td></tr></table></figure>
<h5 id="显示隐藏字符命令-l"><a href="#显示隐藏字符命令-l" class="headerlink" title="显示隐藏字符命令 l"></a>显示隐藏字符命令 <code>l</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># [address1[,address2]]l [len] </span><br><span class="line"># 可显示 空格 tab，实现文本按照指定的宽度换行</span><br><span class="line">sed -n &apos;l 25&apos; books.txt</span><br></pre></td></tr></table></figure>
<h5 id="真正匹配引用-x"><a href="#真正匹配引用-x" class="headerlink" title="真正匹配引用 \x"></a>真正匹配引用 <code>\x</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># () () () ...  \1 \2 \3 ...用\x表示前面的括号内容</span><br><span class="line"># 可显示 空格 tab，实现文本按照指定的宽度换行</span><br><span class="line">sed -r &apos;s/(^[a-z-_]+):x:([0-9]+):([0-9]+).*$/user:\1  uid:\2  gid:\3/&apos; /etc/passwd罗列出用户名 uid gid</span><br></pre></td></tr></table></figure>
<h5 id="复制指定文件内容到匹配行-r"><a href="#复制指定文件内容到匹配行-r" class="headerlink" title="复制指定文件内容到匹配行 r"></a>复制指定文件内容到匹配行 <code>r</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 读取文件内容显示到指定行</span><br><span class="line">sed -n &apos;1r a.txt&apos; b.txt</span><br></pre></td></tr></table></figure>
<h5 id="将匹配行写入到文件中-w"><a href="#将匹配行写入到文件中-w" class="headerlink" title="将匹配行写入到文件中 w"></a>将匹配行写入到文件中 <code>w</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将demo.txt第一行写入到a.txt中</span><br><span class="line">sed -n &apos;1w a.txt&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="执行外部命令-e"><a href="#执行外部命令-e" class="headerlink" title="执行外部命令  e"></a>执行外部命令  <code>e</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># e 执行外部命令 比如 date</span><br><span class="line">sed &apos;3 e date&apos; books.txt</span><br></pre></td></tr></table></figure>
<h5 id="排除命令"><a href="#排除命令" class="headerlink" title="排除命令  !"></a>排除命令  <code>!</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 匹配Paulo的行不打印</span><br><span class="line">sed -n &apos;/Paulo/!p&apos; books.txt</span><br></pre></td></tr></table></figure>
<h5 id="输出行号"><a href="#输出行号" class="headerlink" title="输出行号  ="></a>输出行号  <code>=</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># [address1[,address2]]=</span><br><span class="line">sed &apos;=&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h5 id="退出sed-q"><a href="#退出sed-q" class="headerlink" title="退出sed  q"></a>退出sed  <code>q</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 执行完第10行退出</span><br><span class="line">sed -n &apos;10q&apos; </span><br><span class="line"></span><br><span class="line"># q命令也支持提供一个value(作为程序的返回代码返回)</span><br><span class="line"></span><br><span class="line">sed &apos;/The Alchemist/ q 100&apos; books.txt</span><br><span class="line">echo $?</span><br></pre></td></tr></table></figure>
<h5 id="多行命令-P-D-N"><a href="#多行命令-P-D-N" class="headerlink" title="多行命令  P,D,N"></a>多行命令  <code>P,D,N</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># N：将数据流中的下一行加进来创建一个多行组来处理,N并不会清除、输出模式空间的内容，而是采用了追加模式</span><br><span class="line">sed -n &apos;10q&apos; </span><br><span class="line"></span><br><span class="line"># D：删除多行组中的一行,只删除模式空间中的第一行。该命令会删除到换行符（含 换行符）为止的所有字符</span><br><span class="line"></span><br><span class="line"># P：打印多行组中的一行</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ASED.md" target="_blank" rel="noopener">参考：三十分钟学会SED</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/04/21/UTF-8-without-BOM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/21/UTF-8-without-BOM/" itemprop="url">UTF-8 without BOM</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T11:49:42+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/常见问题/" itemprop="url" rel="index">
                    <span itemprop="name">常见问题</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天遇到一个文件编码问题(非法字符<code>\ufeff</code>)，导致代码异常；经过排查发现：文件编码是 UTF-8 + BOM，表现形式如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">'*&#123;name:'</span>test<span class="string">'&#125;'</span>;</span><br></pre></td></tr></table></figure></p>
<p>但是在编辑器（我用的<code>sublime text</code>）中<strong>看不到那个星号</strong>，在chrome源码显示面板中可以看到，于是设置文件编码<code>sublime text : File &gt; Set File Encoding to(或者保存utf-8编码)</code>，星号依然存在。</p>
<p>解决方案：<br>由于本机安装了<code>Android studio</code>,于是用AS打开该文件，设置编码文件为<code>GBK</code> ,然后设置为<code>UTF-8</code>(特殊字符会变成<code>??</code>去掉多余的<code>?</code>),即可去掉BOM。</p>
<p>在排除过程中也发现另外一个类似的问题:服务端json编码<code>UTF-8 + BOM</code>导致json解析报错。<br>解决方案：<br>设置服务端数据编码格式为<code>UTF-8</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ccrsky.github.io/2017/04/17/linux进程资源信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ccrsky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avator.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ccrsky">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/17/linux进程资源信息/" itemprop="url">linux进程资源信息</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T01:24:36+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Linux进程与资源管理"><a href="#Linux进程与资源管理" class="headerlink" title="Linux进程与资源管理"></a>Linux进程与资源管理</h2><p>Linux最棒的地方在于它的多用户多任务环境，记录下多用户多任务相关的几个常用命令。</p>
<h3 id="前后台进程及切换"><a href="#前后台进程及切换" class="headerlink" title="前后台进程及切换"></a>前后台进程及切换</h3><p>有时候我们并不一定要在屏幕前工作，这时就需要使用到背景工作管理的一些指令，如 <code>&amp;</code>，<code>ctrl+z</code>。</p>
<p>如果想让程序在背景下执行，可以使用 <code>&amp;</code>,由于是背景，该程序的输入并不会显示在屏幕上。</p>
<p>语法格式: <code>command &amp;</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 程序进入背景执行</span></span><br><span class="line">find / -name test &amp;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">fg</span> 将程序拉回屏幕前执行</span></span><br><span class="line">fg</span><br></pre></td></tr></table></figure>
<p>也可以通过 <code>ctrl+z</code> 将正在运行的工作丢到背景下，放在背景下的最大好处就是不会被 <code>ctrl+c</code> 指令中断。</p>
<p>如果出现某个时候需要暂时退出vim，但又不想保存退出，可 <code>ctrl+z</code> 暂时退出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 程序进入背景执行</span></span><br><span class="line">vim a.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将vim放到背景中，并没有退出</span></span><br><span class="line">ctrl+z</span><br></pre></td></tr></table></figure>
<p>可使用 <code>jobs</code> 可以查看任务列表，配合 <code>bg</code> ，<code>fg</code>将程序拉回屏幕。</p>
<p>查看背景程序：<code>jobs</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看背景程序</span></span><br><span class="line">jobs</span><br><span class="line">[1]  + suspended  vim a.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复vim编辑</span></span><br><span class="line">fg %1</span><br></pre></td></tr></table></figure>
<p><code>fg &amp; bg</code>恢复背景进程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">number 为<span class="built_in">jobs</span>中方括号中的编号</span></span><br><span class="line">fg  %number</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将背景程序中的程序由stopped变成running</span></span><br><span class="line">bg %number</span><br></pre></td></tr></table></figure>
<p><code>kill</code> 杀掉背景程序中的程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kill -signal %number</span><br><span class="line">signal</span><br><span class="line">    -1 :重新读取参数配置（类似reload）</span><br><span class="line">    -2 :类似Ctrl+c中断工作</span><br><span class="line">    -9 :强制杀掉进程</span><br><span class="line">    -15 :停止一个工作（默认值）</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash">杀掉vim 进程    </span></span><br><span class="line">kill -9 %1</span><br></pre></td></tr></table></figure>
<h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><p><code>ps</code> 查看进程信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ps -aux</span><br><span class="line">参数说明</span><br><span class="line">    a :显示所有程序</span><br><span class="line">    u :列出所有用户程序</span><br><span class="line">    x :列出所有tty程序</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示进程信息    </span></span><br><span class="line">ps -aux</span><br><span class="line"></span><br><span class="line">USER               PID  %CPU %MEM      VSZ    RSS   TT  STAT STARTED      TIME COMMAND</span><br><span class="line">nali              2557   3.0  1.2  2832304  49180   ??  S    五04下午   4:54.94 /Applications/iTerm 2.app/Contents/MacOS/iTerm2</span><br><span class="line">nali               920   1.6  0.8  2939412  34404   ??  S    四07下午   5:26.69 /Applications/QQ.app/Contents/MacOS/QQ   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">干掉进程 </span></span><br><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure>
<p>另外一个显示进程的命令是 <code>top</code> 可动态显示。<br>查看内存使用：<code>free</code><br>查看系统资源：<code>sar</code></p>
<h3 id="程序优先级"><a href="#程序优先级" class="headerlink" title="程序优先级"></a>程序优先级</h3><p>由于CPU资源有限，优先级高的程序会先获取CPU资源。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps -l</span><br><span class="line"></span><br><span class="line">UID   PID  PPID        F CPU PRI NI       SZ    RSS WCHAN     S             ADDR TTY           TIME CMD</span><br><span class="line">501  9005  2557     4006   0  31  0  2507116   9148 -      Ss                  0 ttys001    0:00.07 /Applications/iTerm 2.app/Contents/MacOS/iTerm2 --server login </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">PRI 代表程序优先级，越小越先被执行</span></span><br><span class="line">NI 代表nice的值</span><br></pre></td></tr></table></figure>
<p><em>PRI越小越优先被执行</em></p>
<p><code>PRI(new) = PRI(old) + nice</code></p>
<blockquote>
<p>一般用户可用的nice值 0~19<br>root可用的nice值-20~19</p>
</blockquote>
<p>调整程序的的优先级<br><code>nice [-n number] command</code></p>
<p>调整运行中程序的优先级<br><code>renice number PID</code></p>
<h3 id="查看系统相关信息"><a href="#查看系统相关信息" class="headerlink" title="查看系统相关信息"></a>查看系统相关信息</h3><p><code>uname</code> 查看系统信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uname </span><br><span class="line">参数信息：</span><br><span class="line">    -a :列出所有信息</span><br><span class="line">    -p :列出CPU信息</span><br><span class="line">    -r :列出核心版本信息</span><br><span class="line">    -n :列出版本信息</span><br></pre></td></tr></table></figure>
<p><code>dmesg</code> 查看启动一闪而过的信息</p>
<p><code>uptime</code> 显示开机时间及负载相关信息</p>
<p><code>last</code> 显示登录信息</p>
<p><code>hostname</code> 显示主机名</p>
<p><code>who</code> 查看当前系统上的用户(只列出用户名及登录时间)</p>
<p><code>w</code> 查看当前系统上的用户(列出用户名及登录时间 + 源地址IP + 工作项 + ..)</p>
<p><code>whoami</code> 显示当前登录用户名</p>
<p><code>ntpdate</code> 网络校时</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 校时服务器 time.stdtime.gov.tw</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行校时命令</span></span><br><span class="line">ntpdate time.stdtime.gov.tw</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可配合crontab定时校时</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avator.jpg"
                alt="ccrsky" />
            
              <p class="site-author-name" itemprop="name">ccrsky</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ccrsky" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/cheng-chen-95-36" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-twitter"></i>知乎</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/u/2464455840" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ccrsky</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
